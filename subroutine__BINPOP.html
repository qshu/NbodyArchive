<html>
  <link REL="STYLESHEET" HREF="syntax.css" TYPE="text/css">
  <body>
    <table cellpadding="20" border="1">
      <thead>
        <tr>
        <td colspan="2"><center><h1>nbody6</h1></center>
<table width="100%">
  <tbody>
    <tr>
      <td width="30%" align="center"><a href="project__nbody6.html">Home</a></td>
      <td width="40%" align="center"><a href="call_project__nbody6.html">Call tree</a></td>
      <td width="30%" align="center"><a href="tree_project__nbody6.html">Structure tree</a></td>
    </tr>
  </tbody>
</table>

</td>
    </tr>
      </thead>
      <tbody>
        <tr>
          <td width="10%" align="left" valign="top"><ul>
  <li><a href="File__absorb.f.html">absorb.f</a></li>
</ul><ul>
  <li><a href="File__adjust.F.html">adjust.F</a></li>
</ul><ul>
  <li><a href="File__bindat.F.html">bindat.F</a></li>
</ul><ul>
  <li><a href="File__binout.f.html">binout.f</a></li>
</ul><ul>
  <li><a href="File__binpop.F.html">binpop.F</a></li>
</ul><ul>
  <li><a href="File__binpop_old.f.html">binpop_old.f</a></li>
</ul><ul>
  <li><a href="File__binpop_pk.f.html">binpop_pk.f</a></li>
</ul><ul>
  <li><a href="File__block.f.html">block.f</a></li>
</ul><ul>
  <li><a href="File__bodies.f.html">bodies.f</a></li>
</ul><ul>
  <li><a href="File__brake.f.html">brake.f</a></li>
</ul><ul>
  <li><a href="File__cfuncs.f.html">cfuncs.f</a></li>
</ul><ul>
  <li><a href="File__chain.f.html">chain.f</a></li>
</ul><ul>
  <li><a href="File__chdata.f.html">chdata.f</a></li>
</ul><ul>
  <li><a href="File__check.f.html">check.f</a></li>
</ul><ul>
  <li><a href="File__checkl.f.html">checkl.f</a></li>
</ul><ul>
  <li><a href="File__chfind.f.html">chfind.f</a></li>
</ul><ul>
  <li><a href="File__chfirr.f.html">chfirr.f</a></li>
</ul><ul>
  <li><a href="File__chinit.f.html">chinit.f</a></li>
</ul><ul>
  <li><a href="File__chlist.f.html">chlist.f</a></li>
</ul><ul>
  <li><a href="File__chmod.f.html">chmod.f</a></li>
</ul><ul>
  <li><a href="File__chpot.f.html">chpot.f</a></li>
</ul><ul>
  <li><a href="File__chstab.f.html">chstab.f</a></li>
</ul><ul>
  <li><a href="File__chterm.f.html">chterm.f</a></li>
</ul><ul>
  <li><a href="File__clint.f.html">clint.f</a></li>
</ul><ul>
  <li><a href="File__cloud.f.html">cloud.f</a></li>
</ul><ul>
  <li><a href="File__cloud0.F.html">cloud0.F</a></li>
</ul><ul>
  <li><a href="File__cmbody.f.html">cmbody.f</a></li>
</ul><ul>
  <li><a href="File__cmcorr.f.html">cmcorr.f</a></li>
</ul><ul>
  <li><a href="File__cmfirr.f.html">cmfirr.f</a></li>
</ul><ul>
  <li><a href="File__cmfreg.f.html">cmfreg.f</a></li>
</ul><ul>
  <li><a href="File__const.f.html">const.f</a></li>
</ul><ul>
  <li><a href="File__core.f.html">core.f</a></li>
</ul><ul>
  <li><a href="File__cputim.F.html">cputim.F</a></li>
</ul><ul>
  <li><a href="File__cstab2.f.html">cstab2.f</a></li>
</ul><ul>
  <li><a href="File__cstab3.f.html">cstab3.f</a></li>
</ul><ul>
  <li><a href="File__cstab4.f.html">cstab4.f</a></li>
</ul><ul>
  <li><a href="File__cstab5.f.html">cstab5.f</a></li>
</ul><ul>
  <li><a href="File__data.F.html">data.F</a></li>
</ul><ul>
  <li><a href="File__define.f.html">define.f</a></li>
</ul><ul>
  <li><a href="File__delay.f.html">delay.f</a></li>
</ul><ul>
  <li><a href="File__derqp.f.html">derqp.f</a></li>
</ul><ul>
  <li><a href="File__derqp3.f.html">derqp3.f</a></li>
</ul><ul>
  <li><a href="File__derqp4.f.html">derqp4.f</a></li>
</ul><ul>
  <li><a href="File__difsy1.f.html">difsy1.f</a></li>
</ul><ul>
  <li><a href="File__difsy3.f.html">difsy3.f</a></li>
</ul><ul>
  <li><a href="File__difsy4.f.html">difsy4.f</a></li>
</ul><ul>
  <li><a href="File__efac2.f.html">efac2.f</a></li>
</ul><ul>
  <li><a href="File__efac3.f.html">efac3.f</a></li>
</ul><ul>
  <li><a href="File__eigenvalue.f.html">eigenvalue.f</a></li>
</ul><ul>
  <li><a href="File__ellan.f.html">ellan.f</a></li>
</ul><ul>
  <li><a href="File__endreg.f.html">endreg.f</a></li>
</ul><ul>
  <li><a href="File__energy.f.html">energy.f</a></li>
</ul><ul>
  <li><a href="File__energy_mpi.f.html">energy_mpi.f</a></li>
</ul><ul>
  <li><a href="File__erel.f.html">erel.f</a></li>
</ul><ul>
  <li><a href="File__erel3.f.html">erel3.f</a></li>
</ul><ul>
  <li><a href="File__erel4.f.html">erel4.f</a></li>
</ul><ul>
  <li><a href="File__escape.F.html">escape.F</a></li>
</ul><ul>
  <li><a href="File__events.f.html">events.f</a></li>
</ul><ul>
  <li><a href="File__evolve.f.html">evolve.f</a></li>
</ul><ul>
  <li><a href="File__expand.f.html">expand.f</a></li>
</ul><ul>
  <li><a href="File__extend.f.html">extend.f</a></li>
</ul><ul>
  <li><a href="File__fchain.f.html">fchain.f</a></li>
</ul><ul>
  <li><a href="File__fclose.f.html">fclose.f</a></li>
</ul><ul>
  <li><a href="File__fcloud.f.html">fcloud.f</a></li>
</ul><ul>
  <li><a href="File__fcorr.f.html">fcorr.f</a></li>
</ul><ul>
  <li><a href="File__ficorr.f.html">ficorr.f</a></li>
</ul><ul>
  <li><a href="File__file_init.F.html">file_init.F</a></li>
</ul><ul>
  <li><a href="File__findj.f.html">findj.f</a></li>
</ul><ul>
  <li><a href="File__flush.f.html">flush.f</a></li>
</ul><ul>
  <li><a href="File__flush.t3e.f.html">flush.t3e.f</a></li>
</ul><ul>
  <li><a href="File__flyby.f.html">flyby.f</a></li>
</ul><ul>
  <li><a href="File__fpcorr.f.html">fpcorr.f</a></li>
</ul><ul>
  <li><a href="File__fpert.f.html">fpert.f</a></li>
</ul><ul>
  <li><a href="File__fpoly1.f.html">fpoly1.f</a></li>
</ul><ul>
  <li><a href="File__fpoly1_mpi.f.html">fpoly1_mpi.f</a></li>
</ul><ul>
  <li><a href="File__fpoly2.f.html">fpoly2.f</a></li>
</ul><ul>
  <li><a href="File__fpoly2_mpi.f.html">fpoly2_mpi.f</a></li>
</ul><ul>
  <li><a href="File__freeze.f.html">freeze.f</a></li>
</ul><ul>
  <li><a href="File__ghost.f.html">ghost.f</a></li>
</ul><ul>
  <li><a href="File__gntage.f.html">gntage.f</a></li>
</ul><ul>
  <li><a href="File__hcorr.f.html">hcorr.f</a></li>
</ul><ul>
  <li><a href="File__hiarch.f.html">hiarch.f</a></li>
</ul><ul>
  <li><a href="File__hidat.f.html">hidat.f</a></li>
</ul><ul>
  <li><a href="File__himax.f.html">himax.f</a></li>
</ul><ul>
  <li><a href="File__himax2.f.html">himax2.f</a></li>
</ul><ul>
  <li><a href="File__hipop.F.html">hipop.F</a></li>
</ul><ul>
  <li><a href="File__histab.f.html">histab.f</a></li>
</ul><ul>
  <li><a href="File__hivel.f.html">hivel.f</a></li>
</ul><ul>
  <li><a href="File__hmdot.f.html">hmdot.f</a></li>
</ul><ul>
  <li><a href="File__hmdot2.f.html">hmdot2.f</a></li>
</ul><ul>
  <li><a href="File__hotsys.F.html">hotsys.F</a></li>
</ul><ul>
  <li><a href="File__hpsort.f.html">hpsort.f</a></li>
</ul><ul>
  <li><a href="File__hrdiag.f.html">hrdiag.f</a></li>
</ul><ul>
  <li><a href="File__hrplot.f.html">hrplot.f</a></li>
</ul><ul>
  <li><a href="File__iblock.f.html">iblock.f</a></li>
</ul><ul>
  <li><a href="File__ichain.f.html">ichain.f</a></li>
</ul><ul>
  <li><a href="File__imf.f.html">imf.f</a></li>
</ul><ul>
  <li><a href="File__imf2.f.html">imf2.f</a></li>
</ul><ul>
  <li><a href="File__imfbd.f.html">imfbd.f</a></li>
</ul><ul>
  <li><a href="File__impact.f.html">impact.f</a></li>
</ul><ul>
  <li><a href="File__inclin.f.html">inclin.f</a></li>
</ul><ul>
  <li><a href="File__indexx.f.html">indexx.f</a></li>
</ul><ul>
  <li><a href="File__inext.f.html">inext.f</a></li>
</ul><ul>
  <li><a href="File__input.F.html">input.F</a></li>
</ul><ul>
  <li><a href="File__insert.f.html">insert.f</a></li>
</ul><ul>
  <li><a href="File__instar.f.html">instar.f</a></li>
</ul><ul>
  <li><a href="File__intgrt.F.html">intgrt.F</a></li>
</ul><ul>
  <li><a href="File__intide.F.html">intide.F</a></li>
</ul><ul>
  <li><a href="File__invert.f.html">invert.f</a></li>
</ul><ul>
  <li><a href="File__kcpert.f.html">kcpert.f</a></li>
</ul><ul>
  <li><a href="File__kepler.f.html">kepler.f</a></li>
</ul><ul>
  <li><a href="File__kick.f.html">kick.f</a></li>
</ul><ul>
  <li><a href="File__ksapo.f.html">ksapo.f</a></li>
</ul><ul>
  <li><a href="File__kscorr.f.html">kscorr.f</a></li>
</ul><ul>
  <li><a href="File__ksin2.f.html">ksin2.f</a></li>
</ul><ul>
  <li><a href="File__ksinit.f.html">ksinit.f</a></li>
</ul><ul>
  <li><a href="File__ksint.F.html">ksint.F</a></li>
</ul><ul>
  <li><a href="File__kslist.f.html">kslist.f</a></li>
</ul><ul>
  <li><a href="File__ksmod.f.html">ksmod.f</a></li>
</ul><ul>
  <li><a href="File__ksperi.f.html">ksperi.f</a></li>
</ul><ul>
  <li><a href="File__kspert.f.html">kspert.f</a></li>
</ul><ul>
  <li><a href="File__ksphys.f.html">ksphys.f</a></li>
</ul><ul>
  <li><a href="File__kspoly.f.html">kspoly.f</a></li>
</ul><ul>
  <li><a href="File__kspred.f.html">kspred.f</a></li>
</ul><ul>
  <li><a href="File__ksrect.f.html">ksrect.f</a></li>
</ul><ul>
  <li><a href="File__ksreg.f.html">ksreg.f</a></li>
</ul><ul>
  <li><a href="File__ksres.f.html">ksres.f</a></li>
</ul><ul>
  <li><a href="File__ksres2.f.html">ksres2.f</a></li>
</ul><ul>
  <li><a href="File__ksterm.f.html">ksterm.f</a></li>
</ul><ul>
  <li><a href="File__kstide.f.html">kstide.f</a></li>
</ul><ul>
  <li><a href="File__lagr.F.html">lagr.F</a></li>
</ul><ul>
  <li><a href="File__levels.f.html">levels.f</a></li>
</ul><ul>
  <li><a href="File__matrix.f.html">matrix.f</a></li>
</ul><ul>
  <li><a href="File__mdot.f.html">mdot.f</a></li>
</ul><ul>
  <li><a href="File__merge.f.html">merge.f</a></li>
</ul><ul>
  <li><a href="File__merge2.f.html">merge2.f</a></li>
</ul><ul>
  <li><a href="File__mloss.f.html">mloss.f</a></li>
</ul><ul>
  <li><a href="File__mlwind.f.html">mlwind.f</a></li>
</ul><ul>
  <li><a href="File__modify.F.html">modify.F</a></li>
</ul><ul>
  <li><a href="File__mydump.F.html">mydump.F</a></li>
</ul><ul>
  <li><a href="File__nbint.f.html">nbint.f</a></li>
</ul><ul>
  <li><a href="File__nblist.f.html">nblist.f</a></li>
</ul><ul>
  <li><a href="File__nbody6.F.html">nbody6.F</a></li>
</ul><ul>
  <li><a href="File__nbpot.f.html">nbpot.f</a></li>
</ul><ul>
  <li><a href="File__nbrem.f.html">nbrem.f</a></li>
</ul><ul>
  <li><a href="File__nbrest.f.html">nbrest.f</a></li>
</ul><ul>
  <li><a href="File__nbsort.f.html">nbsort.f</a></li>
</ul><ul>
  <li><a href="File__nbtide.f.html">nbtide.f</a></li>
</ul><ul>
  <li><a href="File__newreg.f.html">newreg.f</a></li>
</ul><ul>
  <li><a href="File__newsys.f.html">newsys.f</a></li>
</ul><ul>
  <li><a href="File__nlmod.f.html">nlmod.f</a></li>
</ul><ul>
  <li><a href="File__offset.f.html">offset.f</a></li>
</ul><ul>
  <li><a href="File__orbit.f.html">orbit.f</a></li>
</ul><ul>
  <li><a href="File__output.F.html">output.F</a></li>
</ul><ul>
  <li><a href="File__peri.f.html">peri.f</a></li>
</ul><ul>
  <li><a href="File__permit.f.html">permit.f</a></li>
</ul><ul>
  <li><a href="File__pfac.f.html">pfac.f</a></li>
</ul><ul>
  <li><a href="File__physks.f.html">physks.f</a></li>
</ul><ul>
  <li><a href="File__qforce.f.html">qforce.f</a></li>
</ul><ul>
  <li><a href="File__qpmod.f.html">qpmod.f</a></li>
</ul><ul>
  <li><a href="File__qpmod3.f.html">qpmod3.f</a></li>
</ul><ul>
  <li><a href="File__qpmod4.f.html">qpmod4.f</a></li>
</ul><ul>
  <li><a href="File__quad.f.html">quad.f</a></li>
</ul><ul>
  <li><a href="File__r2sort.f.html">r2sort.f</a></li>
</ul><ul>
  <li><a href="File__ran2.f.html">ran2.f</a></li>
</ul><ul>
  <li><a href="File__rchain.f.html">rchain.f</a></li>
</ul><ul>
  <li><a href="File__recoil.f.html">recoil.f</a></li>
</ul><ul>
  <li><a href="File__redraw.f.html">redraw.f</a></li>
</ul><ul>
  <li><a href="File__reduce.f.html">reduce.f</a></li>
</ul><ul>
  <li><a href="File__reflct.f.html">reflct.f</a></li>
</ul><ul>
  <li><a href="File__regint.f.html">regint.f</a></li>
</ul><ul>
  <li><a href="File__reinit.f.html">reinit.f</a></li>
</ul><ul>
  <li><a href="File__remove.f.html">remove.f</a></li>
</ul><ul>
  <li><a href="File__rename.f.html">rename.f</a></li>
</ul><ul>
  <li><a href="File__renew.f.html">renew.f</a></li>
</ul><ul>
  <li><a href="File__reset.f.html">reset.f</a></li>
</ul><ul>
  <li><a href="File__reset2.f.html">reset2.f</a></li>
</ul><ul>
  <li><a href="File__resolv.f.html">resolv.f</a></li>
</ul><ul>
  <li><a href="File__resort.f.html">resort.f</a></li>
</ul><ul>
  <li><a href="File__rsort.f.html">rsort.f</a></li>
</ul><ul>
  <li><a href="File__rssort.f.html">rssort.f</a></li>
</ul><ul>
  <li><a href="File__scale.F.html">scale.F</a></li>
</ul><ul>
  <li><a href="File__search.f.html">search.f</a></li>
</ul><ul>
  <li><a href="File__select.f.html">select.f</a></li>
</ul><ul>
  <li><a href="File__setsys.f.html">setsys.f</a></li>
</ul><ul>
  <li><a href="File__setup.f.html">setup.f</a></li>
</ul><ul>
  <li><a href="File__short.f.html">short.f</a></li>
</ul><ul>
  <li><a href="File__shrink.f.html">shrink.f</a></li>
</ul><ul>
  <li><a href="File__slow.f.html">slow.f</a></li>
</ul><ul>
  <li><a href="File__sort1.f.html">sort1.f</a></li>
</ul><ul>
  <li><a href="File__sort3.f.html">sort3.f</a></li>
</ul><ul>
  <li><a href="File__stabl3.f.html">stabl3.f</a></li>
</ul><ul>
  <li><a href="File__stabl4.f.html">stabl4.f</a></li>
</ul><ul>
  <li><a href="File__stablc.f.html">stablc.f</a></li>
</ul><ul>
  <li><a href="File__stablz.f.html">stablz.f</a></li>
</ul><ul>
  <li><a href="File__star.f.html">star.f</a></li>
</ul><ul>
  <li><a href="File__start.F.html">start.F</a></li>
</ul><ul>
  <li><a href="File__start3.f.html">start3.f</a></li>
</ul><ul>
  <li><a href="File__start4.f.html">start4.f</a></li>
</ul><ul>
  <li><a href="File__status.f.html">status.f</a></li>
</ul><ul>
  <li><a href="File__stepi.f.html">stepi.f</a></li>
</ul><ul>
  <li><a href="File__stepk.f.html">stepk.f</a></li>
</ul><ul>
  <li><a href="File__steps.f.html">steps.f</a></li>
</ul><ul>
  <li><a href="File__stumpf.f.html">stumpf.f</a></li>
</ul><ul>
  <li><a href="File__subint.f.html">subint.f</a></li>
</ul><ul>
  <li><a href="File__subsys.f.html">subsys.f</a></li>
</ul><ul>
  <li><a href="File__swcond.f.html">swcond.f</a></li>
</ul><ul>
  <li><a href="File__switch.f.html">switch.f</a></li>
</ul><ul>
  <li><a href="File__tchain.f.html">tchain.f</a></li>
</ul><ul>
  <li><a href="File__tcirc.f.html">tcirc.f</a></li>
</ul><ul>
  <li><a href="File__tides.f.html">tides.f</a></li>
</ul><ul>
  <li><a href="File__tperi.f.html">tperi.f</a></li>
</ul><ul>
  <li><a href="File__tpert.f.html">tpert.f</a></li>
</ul><ul>
  <li><a href="File__trans3.f.html">trans3.f</a></li>
</ul><ul>
  <li><a href="File__trans4.f.html">trans4.f</a></li>
</ul><ul>
  <li><a href="File__transk.f.html">transk.f</a></li>
</ul><ul>
  <li><a href="File__transq.f.html">transq.f</a></li>
</ul><ul>
  <li><a href="File__transx.f.html">transx.f</a></li>
</ul><ul>
  <li><a href="File__triple.f.html">triple.f</a></li>
</ul><ul>
  <li><a href="File__tstep.f.html">tstep.f</a></li>
</ul><ul>
  <li><a href="File__units.f.html">units.f</a></li>
</ul><ul>
  <li><a href="File__unpert.f.html">unpert.f</a></li>
</ul><ul>
  <li><a href="File__update.f.html">update.f</a></li>
</ul><ul>
  <li><a href="File__vector.f.html">vector.f</a></li>
</ul><ul>
  <li><a href="File__verify.f.html">verify.f</a></li>
</ul><ul>
  <li><a href="File__xcpred.f.html">xcpred.f</a></li>
</ul><ul>
  <li><a href="File__xtf.f.html">xtf.f</a></li>
</ul><ul>
  <li><a href="File__xtpert.f.html">xtpert.f</a></li>
</ul><ul>
  <li><a href="File__xtrnl0.f.html">xtrnl0.f</a></li>
</ul><ul>
  <li><a href="File__xtrnld.f.html">xtrnld.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlf.f.html">xtrnlf.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlp.f.html">xtrnlp.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlu.f.html">xtrnlu.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlv.f.html">xtrnlv.f</a></li>
</ul><ul>
  <li><a href="File__xvpred.f.html">xvpred.f</a></li>
</ul><ul>
  <li><a href="File__ycopy.f.html">ycopy.f</a></li>
</ul><ul>
  <li><a href="File__ysave.f.html">ysave.f</a></li>
</ul><ul>
  <li><a href="File__zare.f.html">zare.f</a></li>
</ul><ul>
  <li><a href="File__zcnsts.f.html">zcnsts.f</a></li>
</ul><ul>
  <li><a href="File__zdata.f.html">zdata.f</a></li>
</ul><ul>
  <li><a href="File__zero.f.html">zero.f</a></li>
</ul><ul>
  <li><a href="File__zfuncs.f.html">zfuncs.f</a></li>
</ul>
</td>
          <td width="90%" valign="top">
            <h2><b>subroutine</b>:<i>BINPOP</i></h2><br>
            <h3>      SUBROUTINE BINPOP
</h3>
            Author:<i></i><br>
            Version:<i></i><br>
            <p>Belongs to: <a href="File__binpop_pk.f.html">binpop_pk.f</a></p>
            <p>Located at: <a href="File__binpop_pk.f.html">binpop_pk.f</a></p>
            <div>Uses:
              <ul>
                <li><a href="subroutine__DATA.html">DATA</a> at <a href="File__data.F.html">data.F</a></li>
              </ul><ul>
                <li><a href="subroutine__DEFINE.html">DEFINE</a> at <a href="File__define.f.html">define.f</a></li>
              </ul><ul>
                <li><a href="function__ran2.html">ran2</a> at <a href="File__ran2.f.html">ran2.f</a></li>
              </ul>
            </div>
            
            <tt>
<br> P. Kroupa   1.04.94
<br>
<br> NOTE: This routine works for <= 100 per cent binaries as the initial
<br> set up. It allows choice of an
<br> initial period distribution and allows eigenevolution of orbital parameters.
<br> It also MERGES the closest binaries to one star.
<br>
<br> NOTE: A more realistic code for pre-main sequence eigenevolution 
<br> is contained in binpop_mardling.f. One day it will have to be 
<br> included in binpop_pk.f as an aditional pre-ms evoltuion sub-routine.
<br>
<br>
<br>
<br>       Initial binary population.
<br>       --------------------------
<br>
</tt>
            <div>Child entities:<br>
            <ul>
              <li><nobr><a href="subroutine__proto_star_evol.html">subroutine: proto_star_evol</a>  </nobr></li>
            </ul><ul>
              <li><nobr><a href="function__gasdev_pk.html">function: gasdev_pk</a>  </nobr></li>
            </ul>
            <hr>
            </div>
            <h3>Variables</h3>
            <table border="1">
              <tr><td>pkmerge</td><td>integer</td><td></td><td></td></tr><tr><td>pk_sing</td><td>integer</td><td></td><td></td></tr><tr><td> XORB(2)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> VORB(2)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> XREL(3)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> VREL(3)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> PX(3)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> QX(3)</td><td>REAL*8</td><td></td><td></td></tr><tr><td> BS(NMAX)</td><td>REAL*8</td><td></td><td></td></tr><tr><td>RAN2</td><td>REAL*4</td><td></td><td></td></tr><tr><td>pkmergedist</td><td>real*8</td><td></td><td></td></tr><tr><td>EBpk</td><td>real*8</td><td></td><td></td></tr><tr><td> bodypk(nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> xpk(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> xdotpk(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> bodymergepk(nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> xmergepk(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> xdotmergepk(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> s_body(nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> s_x(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td> s_xdot(3 , nmax)</td><td>real*8</td><td></td><td></td></tr><tr><td>mass1</td><td>real*8</td><td></td><td></td></tr><tr><td>mass2</td><td>real*8</td><td></td><td></td></tr><tr><td>ecc</td><td>real*8</td><td></td><td></td></tr><tr><td>semi</td><td>real*8</td><td></td><td></td></tr><tr><td>period</td><td>real*8</td><td></td><td></td></tr><tr><td>ecc_initial</td><td>real*8</td><td></td><td></td></tr><tr><td>period_initial</td><td>real*8</td><td></td><td></td></tr><tr><td>qnew</td><td>real*8</td><td></td><td></td></tr><tr><td>qold</td><td>real*8</td><td></td><td></td></tr><tr><td>mtot</td><td>real*8</td><td></td><td></td></tr><tr><td>Ro</td><td>real*8</td><td></td><td></td></tr><tr><td>mtot_initial</td><td>real*8</td><td></td><td></td></tr><tr><td>R_periastron</td><td>real*8</td><td></td><td></td></tr><tr><td>alpha</td><td>real*8</td><td></td><td></td></tr><tr><td>beta</td><td>real*8</td><td></td><td></td></tr><tr><td>ZMBAR</td><td>real*8</td><td></td><td></td></tr><tr><td>RBAR</td><td>real*8</td><td></td><td></td></tr><tr><td>au</td><td>real*8</td><td></td><td></td></tr><tr><td>Rsun</td><td>real*8</td><td></td><td></td></tr><tr><td>idum</td><td>INTEGER</td><td></td><td></td></tr><tr><td>gasdev_pk</td><td>REAL</td><td></td><td></td></tr><tr><td>iset</td><td>INTEGER</td><td></td><td></td></tr><tr><td>fac</td><td>REAL</td><td></td><td></td></tr><tr><td>gset</td><td>REAL</td><td></td><td></td></tr><tr><td>rsq</td><td>REAL</td><td></td><td></td></tr><tr><td>v1</td><td>REAL</td><td></td><td></td></tr><tr><td>v2</td><td>REAL</td><td></td><td></td></tr><tr><td>ran2</td><td>REAL</td><td></td><td></td></tr>
            </table>
            <pre class="source">      <span class="kw">SUBROUTINE</span> <a href="subroutine__BINPOP.html">BINPOP</a>
<span class="comm">C
</span><span class="comm">C P. Kroupa   1.04.94
</span><span class="comm">C
</span><span class="comm">C NOTE: This routine works for <= 100 per cent binaries as the initial
</span><span class="comm">C set up. It allows choice of an
</span><span class="comm">C initial period distribution and allows eigenevolution of orbital parameters.
</span><span class="comm">C It also MERGES the closest binaries to one star.
</span><span class="comm">C
</span><span class="comm">C NOTE: A more realistic code for pre-main sequence eigenevolution 
</span><span class="comm">C is contained in binpop_mardling.f. One day it will have to be 
</span><span class="comm">C included in binpop_pk.f as an aditional pre-ms evoltuion sub-routine.
</span><span class="comm">C
</span><span class="comm">*
</span><span class="comm">*
</span><span class="comm">*       Initial binary population.
</span><span class="comm">*       --------------------------
</span><span class="comm">*
</span>      <span class="kw">INCLUDE</span> <span class="str">'common6.h'</span>
      <span class="dtype">integer</span>  pkmerge,pk_sing
      <span class="dtype">REAL</span>*8  XORB(2),VORB(2),XREL(3),VREL(3),PX(3),QX(3),BS(NMAX)
      <span class="dtype">REAL</span>*4  <a href="function__ran2.html">RAN2</a>
      <span class="dtype">real</span>*8  pkmergedist,EBpk
<span class="comm">* Additional vars for MERGED components:
</span>      <span class="dtype">real</span>*8  bodypk(nmax),xpk(3,nmax),xdotpk(3,nmax)
      <span class="dtype">real</span>*8  bodymergepk(nmax),xmergepk(3,nmax),xdotmergepk(3,nmax)
<span class="comm">* Additional vars for initially single stars:
</span>      <span class="dtype">real</span>*8  s_body(nmax),s_x(3,nmax),s_xdot(3,nmax)
<span class="comm">*
</span><span class="comm">*
</span>      pkmerge = 0
<span class="comm">*
</span><span class="comm">*
</span>      READ (5,*)  NBIN, SEMI0, ECC0, RATIO,RANGE, NSKIP, IDORM
      NBIN0 = NBIN
      NBIN1 = NBIN + 1
      WRITE (6,1)  NBIN, SEMI0, ECC0, RATIO, RANGE, NSKIP, IDORM
    1 <span class="kw">FORMAT</span> (/,12X,<span class="str">'BINARIES:   NBIN ='</span>,I4,<span class="str">'  A ='</span>,F9.6,<span class="str">'  E ='</span>,F6.2,
              <span class="str">'  RATIO ='</span>,F4.1,<span class="str">'  RANGE ='</span>,F6.1,<span class="str">'  NSKIP ='</span>,I3,
              <span class="str">'  IDORM ='</span>,I2,/)
<span class="comm">*
</span><span class="comm">*       Check type of binary mass distribution (NSKIP, IMF2 or split c.m.).
</span>      <span class="kw">IF</span> (NSKIP.EQ.0.OR.KZ(20).GE.2) GO TO 10
      <span class="kw">IF</span> (RATIO.EQ.1.0) GO TO 20
<span class="comm">*
</span><span class="comm">*       Select binaries from the most massive bodies (frequency NSKIP).
</span>      ILAST = (1 + NSKIP)*NBIN
      JSKIP = 0
      JS = 0
      JB = 1
<span class="comm">*
</span><span class="comm">*       Transfer binary masses to first NBIN locations.
</span>      <span class="kw">DO</span> 6 I = 2,ILAST
          JSKIP = JSKIP + 1
<span class="comm">*       Copy binary mass of body #I to new global location.
</span>          <span class="kw">IF</span> (JSKIP.GT.NSKIP) <span class="kw">THEN</span>
              JSKIP = 0
              JB = JB + 1
              BODY(JB) = BODY(I)
          <span class="kw">ELSE</span>
<span class="comm">*       Save next NSKIP masses of single bodies.
</span>              JS = JS + 1
              BS(JS) = BODY(I)
          <span class="kw">END</span> <span class="kw">IF</span>
    6 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Restore the single bodies in subsequent locations.
</span>      JS = 0
      <span class="kw">DO</span> 8 I = NBIN1,ILAST
          JS = JS + 1
          BODY(I) = BS(JS)
    8 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Move main variables of all single bodies.
</span>   10 <span class="kw">DO</span> 15 I = N,NBIN1,-1
          J = I + NBIN
          BODY(J) = BODY(I)
          <span class="kw">DO</span> 12 K = 1,3
              X(K,J) = X(K,I)
              XDOT(K,J) = XDOT(K,I)
   12     <span class="kw">CONTINUE</span>
   15 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Create space for each binary component next to primary.
</span>   20 <span class="kw">DO</span> 30 I = NBIN,2,-1
          J = 2*I - 1
          BODY(J) = BODY(I)
          <span class="kw">DO</span> 25 K = 1,3
              X(K,J) = X(K,I)
              XDOT(K,J) = XDOT(K,I)
   25     <span class="kw">CONTINUE</span>
   30 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*=========================================================
</span><span class="comm">*=======================THE LOOP==========================
</span><span class="comm">*=========================================================
</span><span class="comm">*       Introduce binary components from relative motion.
</span>      <span class="kw">DO</span> 60 I = 1,NBIN
<span class="comm">*
</span><span class="comm">*       Randomize perihelion, node & inclination.
</span>          PI = TWOPI*<a href="function__ran2.html">RAN2</a>(IDUM1)
          OMEGA = TWOPI*<a href="function__ran2.html">RAN2</a>(IDUM1)
          ZI = 0.5*TWOPI*<a href="function__ran2.html">RAN2</a>(IDUM1)
<span class="comm">*
</span><span class="comm">*       Set transformation elements (Brouwer & Clemence p. 35).
</span>          PX(1) = COS(PI)*COS(OMEGA) - SIN(PI)*SIN(OMEGA)*COS(ZI)
          QX(1) =-SIN(PI)*COS(OMEGA) - COS(PI)*SIN(OMEGA)*COS(ZI)
          PX(2) = COS(PI)*SIN(OMEGA) + SIN(PI)*COS(OMEGA)*COS(ZI)
          QX(2) =-SIN(PI)*SIN(OMEGA) + COS(PI)*COS(OMEGA)*COS(ZI)
          PX(3) = SIN(PI)*SIN(ZI)
          QX(3) = COS(PI)*SIN(ZI)
<span class="comm">*
</span><span class="comm">*       Specify component masses (copy BODY0 from IMF2 or use RATIO).
</span>          I1 = 2*I - 1
          I2 = 2*I
          <span class="kw">IF</span> (KZ(20).GE.2) <span class="kw">THEN</span>
              BODY(I1) = BODY0(I1)
              BODY(I2) = BODY0(I2)
          <span class="kw">ELSE</span> <span class="kw">IF</span> (RATIO.EQ.1.0) <span class="kw">THEN</span>
              BODY(I2) = BODY(I1)
          <span class="kw">ELSE</span>
              BODY(I1) = RATIO*BODY(I1)
              BODY(I2) = BODY(I1)*(1.0 - RATIO)/RATIO
          <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">***************************
</span><span class="comm">* Choose
</span><span class="comm">*
</span><span class="comm">* ECC0<0:     thermal distribution f(e)=2e
</span><span class="comm">* 0<=ECC0<=1  fixed eccentricity
</span><span class="comm">* ECC0=20     a uniform distr. between 0 and 1
</span><span class="comm">* ECC0=30     an exponentially decreasing distribution akin to the data in
</span><span class="comm">*             Fig.6a of Duquennoy and Mayor 1991: f(e)=0.1765/(e*e), 0.15<=e<=1
</span><span class="comm">* ECC0=40:
</span><span class="comm">*             The general distribution is (9.02.94):
</span><span class="comm">*                              f(e) = a e^b   e0<=e<=1
</span><span class="comm">*             with   a = (1+b) / (1-e0^(1+b))
</span><span class="comm">*             Its generating function is
</span><span class="comm">*                              e(X) = [((1+b)/a)X + e0^(1+b)]^(1/(1+b))
</span><span class="comm">*             Choose some a and b below.
</span><span class="comm">*             Get thermal distribution if b=1 with e0=0
</span><span class="comm">*
</span>          <span class="kw">IF</span> (ECC0.LT.0.0) <span class="kw">THEN</span>
              ECC2 = <a href="function__ran2.html">RAN2</a>(IDUM1)
              ECC = SQRT(ECC2)
          <span class="kw">else</span> <span class="kw">if</span> (ecc0.EQ.20) <span class="kw">then</span>
              ecc = <a href="function__ran2.html">RAN2</a>(IDUM1)
<span class="comm">*
</span>          <span class="kw">else</span> <span class="kw">if</span> (ecc0.EQ.30) <span class="kw">then</span>
              ecc = 1./0.15 - <a href="function__ran2.html">RAN2</a>(IDUM1)/0.1765
              ecc = 1./ecc
<span class="comm">*
</span>          <span class="kw">else</span> <span class="kw">if</span> (ecc0.EQ.40) <span class="kw">then</span>
              PK_e0 = 0.D0
              PK_b = 1.D0
              PK_a = (1.D0+PK_b) / (1.D0 - PK_e0**(1.D0+PK_b))
              ecc = <a href="function__ran2.html">RAN2</a>(IDUM1)
              ecc = ((PK_b+1.D0)/PK_a)*ecc + PK_e0**(1.D0+PK_b)
              ecc = ecc**(1.D0/(1.D0+PK_b))
<span class="comm">*
</span><span class="comm">*
</span>          <span class="kw">ELSE</span> <span class="kw">if</span> (ecc0.GE.0.0.AND.ecc0.LE.1.) <span class="kw">then</span>
              ECC = ECC0
          <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*****************************
</span><span class="comm">*
</span><span class="comm">*       Select semi-major axis from uniform distribution in log(A),
</span><span class="comm">*       or a uniform distribution in the range semi0 (=min. ecc.)
</span><span class="comm">*       to semi0+range (=max. ecc.), or SEMI0.
</span><span class="comm">*
</span><span class="comm">* Use distribution in semi-major axis if
</span><span class="comm">* BK(2)=0: RANGE>0: uniform distribution in log(semi) between SEMI0 and
</span><span class="comm">*                    SEMI0/RANGE
</span><span class="comm">*           RANGE<0: uniform distribution in semi between SEMI0 and -1*RANGE.
</span><span class="comm">*
</span><span class="comm">* Use distribution in logP(days) if
</span><span class="comm">* BK(2)=1:  linearly increasing distribution function f=0.03438*logP
</span><span class="comm">* BK(2)=2:  f=3.5logP/[100+(logP)**2]
</span><span class="comm">* BK(2)=1,2 are 1st and 2nd iterations!
</span><span class="comm">* BK(2)=3:  f=2.3(logP-1)/[45+(logP-1)**2] This is a "3rd" iteration when
</span><span class="comm">*            pre-ms evolution is taken into account with BK(1).NE.0.
</span><span class="comm">* BK(2)=4:  f=2.5(logP-1)/[45+(logP-1)**2] This is a "34th" iteration when
</span><span class="comm">*            pre-ms evolution is taken into account with BK(1).NE.0, and
</span><span class="comm">*            RBAR<1.5 (in runs /run34n RBAR=1.5 with BK(2)=3 lead to
</span><span class="comm">*            wrong qone distr.
</span><span class="comm">* BK(2)=5:  Duquennoy & Mayor 1991, Gaussian distr. 
</span><span class="comm">*            with mean logP=4.8, SDEV in logP=2.3. Use Num.Recipes
</span><span class="comm">*            routine "gasdev.f" to obtain random deviates given "idum1". 
</span><span class="comm">*========= BK(2) = 0 ========
</span>          <span class="kw">if</span> (BK(2).EQ.0) <span class="kw">then</span>
             <span class="kw">IF</span> (RANGE.GT.0.0) <span class="kw">THEN</span>
                 EXP1 = <a href="function__ran2.html">RAN2</a>(IDUM1)*LOG10(RANGE)
                 SEMI = SEMI0/10.0**EXP1
             <span class="kw">else</span> <span class="kw">if</span> (range.LT.0.0) <span class="kw">then</span>
                 exp1 = <a href="function__ran2.html">RAN2</a>(IDUM1)*(-1*range-semi0)
                 semi = semi0 + exp1
             <span class="kw">ELSE</span>
                 SEMI = SEMI0
             <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*========= BK(2) = 1 ========
</span>          <span class="kw">else</span> <span class="kw">if</span> (BK(2).EQ.1) <span class="kw">then</span>
<span class="comm">* exp = logP(days)
</span>             exp1 = SQRT(<a href="function__ran2.html">RAN2</a>(IDUM1)*2.0/0.03438)
<span class="comm">* Period in yrs:
</span>             exp1 = 10**exp1 /365.25
<span class="comm">* transform to semi-major axis in model units to continue prgrm from here
</span><span class="comm">* as before (i.e. when semi-major axis is chosen): Use Kepler law:
</span><span class="comm">* M1+M2 = a**3/P**2, where mass is in Msun, and a is in AU.
</span>             semi = (BODY(I1)+BODY(I2))*ZMBAR*exp1*exp1
             semi = semi**(1./3.)
<span class="comm">* semi in pc and then in modell units:
</span>             semi = semi/206259.591
             semi = semi/RBAR
<span class="comm">*========= BK(2) = 2 ========
</span>          <span class="kw">else</span> <span class="kw">if</span> (BK(2).EQ.2) <span class="kw">then</span>
             exp1 = EXP(2.0*<a href="function__ran2.html">RAN2</a>(IDUM1)/3.50) - 1.
             exp1 = SQRT(exp1*100.)
<span class="comm">* exp = logP(days)
</span><span class="comm">* Period in yrs:
</span>             exp1 = 10**exp1 /365.25
<span class="comm">* transform to semi-major axis in model units to continue prgrm from here
</span><span class="comm">* as before (i.e. when semi-major axis is chosen): Use Kepler law:
</span><span class="comm">* M1+M2 = a**3/P**2, where mass is in Msun, and a is in AU.
</span>             semi = (BODY(I1)+BODY(I2))*ZMBAR*exp1*exp1
             semi = semi**(1./3.)
<span class="comm">* semi in pc and then in modell units:
</span>             semi = semi/206259.591
             semi = semi/RBAR
<span class="comm">*========= BK(2) = 3 ========
</span>          <span class="kw">else</span> <span class="kw">if</span> (BK(2).EQ.3) <span class="kw">then</span>
             exp1 = EXP(2.D0*<a href="function__ran2.html">RAN2</a>(IDUM1)/2.3D0) - 1.D0
             exp1 = SQRT(exp1*45.D0) + 1.D0
<span class="comm">* exp = logP(days)
</span><span class="comm">* Period in yrs:
</span>             exp1 = 10**exp1 /365.25D0
<span class="comm">* transform to semi-major axis in model units to continue prgrm from here
</span><span class="comm">* as before (i.e. when semi-major axis is chosen): Use Kepler law:
</span><span class="comm">* M1+M2 = a**3/P**2, where mass is in Msun, and a is in AU.
</span>             semi = (BODY(I1)+BODY(I2))*ZMBAR*exp1*exp1
             semi = semi**(1.D0/3.D0)
<span class="comm">* semi in pc and then in modell units:
</span>             semi = semi/206259.591D0
             semi = semi/RBAR
<span class="comm">*========= BK(2) = 4 ========
</span>          <span class="kw">else</span> <span class="kw">if</span> (BK(2).EQ.4) <span class="kw">then</span>
             exp1 = EXP(2.D0*<a href="function__ran2.html">RAN2</a>(IDUM1)/2.5D0) - 1.D0
             exp1 = SQRT(exp1*45.D0) + 1.D0
<span class="comm">* exp = logP(days)
</span><span class="comm">* Period in yrs:
</span>             exp1 = 10**exp1 /365.25D0
<span class="comm">* transform to semi-major axis in model units to continue prgrm from here
</span><span class="comm">* as before (i.e. when semi-major axis is chosen): Use Kepler law:
</span><span class="comm">* M1+M2 = a**3/P**2, where mass is in Msun, and a is in AU.
</span>             semi = (BODY(I1)+BODY(I2))*ZMBAR*exp1*exp1
             semi = semi**(1.D0/3.D0)
<span class="comm">* semi in pc and then in modell units:
</span>             semi = semi/206259.591D0
             semi = semi/RBAR
<span class="comm">*========= BK(2) = 5 ========
</span>          <span class="kw">else</span> <span class="kw">if</span> (BK(2).EQ.5) <span class="kw">then</span>
             exp1 = -10.
<span class="comm">C Only accept periods logP>1, i.e. longer than 10 days at birth
</span><span class="comm">C AND periods shorter than 10^(10) days!
</span>             <span class="kw">do</span> <span class="kw">while</span> (exp1.LT.-1.6522)
                exp1 = <a href="function__gasdev_pk.html">GASDEV_pk</a>(IDUM1)
                <span class="kw">if</span> (exp1.GT.2.2696) exp1=-10.
             <span class="kw">end</span> <span class="kw">do</span>
<span class="comm">* exp1 is now a Gaussian deviate with mean zero and unit variance
</span><span class="comm">* Transform to mean=4.8 and variance = 2.3*2.3, i.e to logP, P in days
</span>            exp1 = 2.3*exp1 + 4.8
<span class="comm">* exp = logP(days)
</span><span class="comm">* Period in yrs:
</span>             exp1 = 10**exp1 /365.25D0
<span class="comm">* transform to semi-major axis in model units to continue prgrm from here
</span><span class="comm">* as before (i.e. when semi-major axis is chosen): Use Kepler law:
</span><span class="comm">* M1+M2 = a**3/P**2, where mass is in Msun, and a is in AU.
</span>             semi = (BODY(I1)+BODY(I2))*ZMBAR*exp1*exp1
             semi = semi**(1.D0/3.D0)
<span class="comm">* semi in pc and then in modell units:
</span>             semi = semi/206259.591D0
             semi = semi/RBAR
<span class="comm">*========= BK(2) = ? ========
</span>          <span class="kw">else</span>
             write(6,*)<span class="str">' No BK(2) defined!!!!! '</span>
             <span class="kw">STOP</span>
          <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">* At this stage we have the mases, eccentricity and period of each binary
</span><span class="comm">* at "birth", i.e. prior to circularisation and "feeding". Now evolve these
</span><span class="comm">* to very, very roughly take into account complete circularisation,
</span><span class="comm">* partial circularisation and "feeding". Do this if option BK(1)=1:
</span><span class="comm">* (i.e. mass-exchange at proto-stellar time):
</span>          <span class="kw">if</span> (BK(1).EQ.1) <span class="kw">then</span>
             <span class="kw">call</span> <a href="subroutine__proto_star_evol.html">proto_star_evol</a>(
          ZMBAR,RBAR,BODY(I1),BODY(I2),ECC,SEMI)
          <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span><span class="comm">*       Specify relative motion at apocentre.
</span>          XORB(1) = SEMI*(1.0 + ECC)
          XORB(2) = 0.0
          VORB(1) = 0.0
          ZMBIN = BODY(I1) + BODY(I2)
          VORB(2) = SQRT(ZMBIN*(1.0D0 - ECC)/(SEMI*(1.0D0 + ECC)))
          EBpk =  -0.5*BODY(I1)*BODY(I2)/SEMI
<span class="comm">C Moved below to account for accepted binaries only.
</span><span class="comm">C          EBIN0 = EBIN0 - 0.5*BODY(I1)*BODY(I2)/SEMI
</span><span class="comm">*
</span><span class="comm">*       Transform to relative variables.
</span>          <span class="kw">DO</span> 40 K = 1,3
              XREL(K) = PX(K)*XORB(1) + QX(K)*XORB(2)
              VREL(K) = PX(K)*VORB(1) + QX(K)*VORB(2)
   40     <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Set global variables for each component.
</span>          <span class="kw">DO</span> 50 K = 1,3
              X(K,I1) = X(K,I1) + BODY(I2)*XREL(K)/ZMBIN
              X(K,I2) = X(K,I1) - XREL(K)
              XDOT(K,I1) = XDOT(K,I1) + BODY(I2)*VREL(K)/ZMBIN
              XDOT(K,I2) = XDOT(K,I1) - VREL(K)
   50     <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">* Merge binaries that have semi.LE.10 solar radii (all in AU):
</span><span class="comm">* Solar radius in AU is 4.6523D-3.
</span>          semi = semi*RBAR*206259.591D0
          pkmergedist = 10.D0 * 4.6523D-3
<span class="comm">c          pkmergedist = 50000.D0 * 4.6523D-3
</span>          J1 = I1 -2*pkmerge
          J2 = I2 -2*pkmerge
          <span class="kw">if</span> (semi.LE.pkmergedist) <span class="kw">then</span>
             pkmerge = pkmerge + 1
             ZMBIN = BODY(I1) + BODY(I2)
<span class="comm">C Added 20.8.96:
</span>             write(6,*)
             write(6,*)<span class="str">' MERGED stars in binpop_pk.f:'</span>
             write(6,*)<span class="str">' mass1, mass2, total mass [Msun]'</span>
             write(6,<span class="str">'(3F8.3)'</span>)body(I1)*ZMBAR,body(I2)*ZMBAR,
                         zmbin*ZMBAR 
<span class="comm">C End added bit. 
</span>             <span class="kw">do</span> K = 1,3
                 Xmergepk(K,pkmerge) = (BODY(I1)*X(K,I1) +
                         BODY(I2)*X(K,I2))/ZMBIN
                 XDOTmergepk(K,pkmerge) = (BODY(I1)*XDOT(K,I1) +
                         BODY(I2)*XDOT(K,I2))/ZMBIN
             <span class="kw">end</span> <span class="kw">do</span>
             BODYmergepk(pkmerge) = ZMBIN
          <span class="kw">else</span>
<span class="comm">C Sum binding energy for accepted binaries.
</span>             EBIN0 = EBIN0 + EBpk
             bodypk(J1) = body(I1)
             bodypk(J2) = body(I2)
             <span class="kw">do</span> k=1,3
                xpk(k,J1) = x(k,I1)
                xpk(k,J2) = x(k,I2)
                xdotpk(k,J1) = xdot(k,I1)
                xdotpk(k,J2) = xdot(k,I2)
             <span class="kw">end</span> <span class="kw">do</span>
          <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span><span class="comm">*=========================================================
</span><span class="comm">*=================end of THE LOOP=========================
</span><span class="comm">*=========================================================
</span>   60 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">C Kroupa: 5.11.96
</span><span class="comm">C Take into account possible initial single stars. Before merging above 
</span><span class="comm">C these occupy positions: 2*NBIN+1....N+NBIN (before merging the stars 
</span><span class="comm">C in binaries occupy positions 1,2,....2*NBIN). 
</span>      pk_sing = 0
      <span class="kw">do</span> i=2*NBIN+1,N+NBIN
         pk_sing = pk_sing+1
         s_body(pk_sing)=body(i)
         <span class="kw">do</span> k=1,3
            s_x(k,pk_sing) = x(k,i)
            s_xdot(k,pk_sing) = xdot(k,i)
         <span class="kw">end</span> <span class="kw">do</span>
      <span class="kw">end</span> <span class="kw">do</span>
<span class="comm">*
</span><span class="comm">*       Update the total particle number after primary splitting or IMF2
</span><span class="comm">*       and introduce additional counters for MERGING:
</span>      <span class="kw">IF</span> (RATIO.LT.1.0.OR.KZ(20).GE.2) <span class="kw">THEN</span>
          N = N + NBIN
          NZERO = N
          NTOT = N
          BODYM = ZMASS/FLOAT(N)
          <span class="kw">IF</span> (NSKIP.GT.0) <span class="kw">THEN</span>
              WRITE (6,62)  (BODY(J),J=1,10)
              WRITE (6,64)  (BODY(J),J=2*NBIN+1,2*NBIN+10)
   62         <span class="kw">FORMAT</span> (/,12X,<span class="str">'BINARY MASSES (1-10):  '</span>,10F9.5)
   64         <span class="kw">FORMAT</span> (/,12X,<span class="str">'SINGLE MASSES (1-10):  '</span>,10F9.5,/)
          <span class="kw">END</span> <span class="kw">IF</span>
      <span class="kw">END</span> <span class="kw">IF</span>
      Npk = N - pkmerge
      NZEROpk = Npk
      NTOTpk = Npk
      NBINpk = NBIN - pkmerge
<span class="comm">c+++
</span><span class="comm">CCCCCCCCCCCC for testing:
</span>        close(54)
        write(6,*)
        write(6,*)<span class="str">' In BINPOP_PK :'</span>
        write(6,*)<span class="str">'****************************************'</span>
        write(6,*)<span class="str">'N,NBIN,NBIN0,NBINpk,pkmerge,Npk,pk_sing:'</span>
        write(6,<span class="str">'(7(I6))'</span>)N,NBIN,NBIN0,NBINpk,pkmerge,
                    Npk,pk_sing
<span class="comm">c        write(6,*)
</span><span class="comm">c        write(6,*)
</span><span class="comm">c        write(6,*)' original stars'
</span><span class="comm">c        do i=1,N
</span><span class="comm">c           write(6,'(I4,7(F8.3))') i,body(i)*ZMBAR,
</span><span class="comm">c     +     (X(k,i),xdot(k,i),k=1,3)
</span><span class="comm">c        end do
</span><span class="comm">c        write(6,*)
</span><span class="comm">c        write(6,*)
</span><span class="comm">c        write(6,*)' remaining binaries'
</span><span class="comm">c        do i=1,2*NBINpk
</span><span class="comm">c           write(6,'(I4,7(F8.3))') i,bodypk(i)*ZMBAR,
</span><span class="comm">c     +     (Xpk(k,i),xdotpk(k,i),k=1,3)
</span><span class="comm">c        end do
</span><span class="comm">c        write(6,*)
</span><span class="comm">c        write(6,*)' merged ones:'
</span><span class="comm">c        do i=1,pkmerge
</span><span class="comm">c           write(6,'(I4,7(F8.3))') i,bodymergepk(i)*ZMBAR,
</span><span class="comm">c     +     (Xmergepk(k,i),xdotmergepk(k,i),k=1,3)
</span><span class="comm">c        end do
</span><span class="comm">c        write(6,*)'****************************************'
</span><span class="comm">c        call flush(6)
</span><span class="comm">CCCCCCCCCCCCCC
</span><span class="comm">*
</span><span class="comm">* Now overwrite the old vars with the MERGED ones:
</span>      N = Npk
      NTOT = ntotpk
      NZERO = nzeropk
      NBIN0 = NBIN0 - pkmerge
      NBIN = NBINpk
<span class="comm">C The stars in remaining binaries:
</span>      <span class="kw">do</span> i=1,2*NBIN
         body(i) = bodypk(i)
         <span class="kw">do</span> k=1,3
            x(k,i) = xpk(k,i)
            xdot(k,i) = xdotpk(k,i)
         <span class="kw">end</span> <span class="kw">do</span>
      <span class="kw">end</span> <span class="kw">do</span>
<span class="comm">C Add merged (i.e single) stars to end of the above list of stars in binaries:
</span>      j = 2*NBIN
      <span class="kw">do</span> i=1,pkmerge
         j = j+1
         body(j) = bodymergepk(i)
         <span class="kw">do</span> k=1,3
            x(k,j) = xmergepk(k,i)
            xdot(k,j) = xdotmergepk(k,i)
         <span class="kw">end</span> <span class="kw">do</span>
      <span class="kw">end</span> <span class="kw">do</span>
<span class="comm">C Add the initially single stars again at end of the lot:
</span>      <span class="kw">do</span> i=1,pk_sing
         j=j+1
         body(j) = s_body(i)
         <span class="kw">do</span> k=1,3
            x(k,j)=s_x(k,i)
            xdot(k,j)=s_xdot(k,i)
         <span class="kw">end</span> <span class="kw">do</span>
      <span class="kw">end</span> <span class="kw">do</span>
<span class="comm">*
</span><span class="comm">C Added 11.08.98 with Sverre Aarseth: (body0 needed for 
</span><span class="comm">C stellar evolution!)
</span>      <span class="kw">if</span> (j.ne.ntot) <span class="kw">then</span> 
         write(6,*)j,ntot,<span class="str">' ****** j & ntot must be equal ******'</span>
         <span class="kw">stop</span>
      <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span>      zmass = 0.D0
      <span class="kw">do</span> i=1,ntot
         body0(i) = body(i)
         zmass = zmass + body0(i)
      <span class="kw">end</span> <span class="kw">do</span>
      BODYM = ZMASS/FLOAT(N)
      write(6,*)
      write(6,*)<span class="str">' BODYM, ZMASS and BODY0(i) updated.'</span>
      write(6,<span class="str">'(2(a,F10.4))'</span>)<span class="str">' BODYM= '</span>,BODYM,<span class="str">' ZMASS= '</span>,ZMASS
      write(6,*)
<span class="comm">*
</span><span class="comm">c+++ for testing:
</span><span class="comm">c      write(6,*)
</span><span class="comm">c      write(6,*)
</span><span class="comm">c      write(6,*)' After merging & re-arranging:'
</span><span class="comm">c      write(6,*)' N,NBIN0,NTOT: ',N,NBIN0,NTOT
</span><span class="comm">c      do i=1,N
</span><span class="comm">c         write(6,'(I3,7(F8.3))')i,body(i)*ZMBAR,
</span><span class="comm">c     +   (x(k,i),xdot(k,i),k=1,3)
</span><span class="comm">c      end do
</span><span class="comm">c      call flush(6)
</span><span class="comm">*
</span><span class="comm">*
</span><span class="comm">*       Include procedure for introducing dormant binaries.
</span>      <span class="kw">IF</span> (IDORM.GT.0) <span class="kw">THEN</span>
          <span class="kw">DO</span> 66 I = 1,NBIN
              I1 = 2*I - 1
              I2 = I1 + 1
              ZMBIN = BODY(I1) + BODY(I2)
              <span class="kw">DO</span> 65 K = 1,3
                  X(K,I) = (BODY(I1)*X(K,I1) + BODY(I2)*X(K,I2))/ZMBIN
                  XDOT(K,I) = (BODY(I1)*XDOT(K,I1) +
                         BODY(I2)*XDOT(K,I2))/ZMBIN
   65         <span class="kw">CONTINUE</span>
              BODY(I) = ZMBIN
   66     <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Move the original single particles up to form compact array.
</span>          I1 = 2*NBIN + 1
          I2 = NBIN
          <span class="kw">DO</span> 68 I = I1,N
              I2 = I2 + 1
              BODY(I2) = BODY(I)
              <span class="kw">DO</span> 67 K = 1,3
                  X(K,I2) = X(K,I)
                  XDOT(K,I2) = XDOT(K,I)
   67         <span class="kw">CONTINUE</span>
   68     <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Reset particle membership and turn off binary output option (if = 1).
</span>          N = N - NBIN
          NZERO = N
          NTOT = N
          NBIN0 = 0
          EBIN0 = 0.0
          <span class="kw">IF</span> (KZ(8).EQ.1) KZ(8) = 0
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Set coordinates & velocities in c.m. rest frame.
</span>      <span class="kw">DO</span> 70 K = 1,3
          CMR(K) = 0.0D0
          CMRDOT(K) = 0.0D0
   70 <span class="kw">CONTINUE</span>
<span class="comm">*
</span>      <span class="kw">DO</span> 80 I = 1,N
          <span class="kw">DO</span> 75 K = 1,3
              CMR(K) = CMR(K) + BODY(I)*X(K,I)
              CMRDOT(K) = CMRDOT(K) + BODY(I)*XDOT(K,I)
   75     <span class="kw">CONTINUE</span>
   80 <span class="kw">CONTINUE</span>
<span class="comm">*
</span>      <span class="kw">DO</span> 90 I = 1,N
          <span class="kw">DO</span> 85 K = 1,3
              X(K,I) = X(K,I) - CMR(K)/ZMASS
              XDOT(K,I) = XDOT(K,I) - CMRDOT(K)/ZMASS
   85     <span class="kw">CONTINUE</span>
   90 <span class="kw">CONTINUE</span>
<span class="comm">*
</span>      <span class="kw">RETURN</span>
<span class="comm">*
</span>      <span class="kw">END</span>
<span class="comm">C=======================================================
</span><span class="comm">C=======================================================
</span>      <span class="kw">subroutine</span> <a href="subroutine__proto_star_evol.html">proto_star_evol</a>(ZMBAR,RBAR,mass1,mass2,ECC,SEMI)
<span class="comm">*
</span>      <span class="dtype">implicit</span> none
      <span class="dtype">real</span>*8          mass1,mass2,ecc,semi,period
      <span class="dtype">real</span>*8          ecc_initial,period_initial
      <span class="dtype">real</span>*8          qnew,qold,mtot,Ro,mtot_initial
      <span class="dtype">real</span>*8          R_periastron,alpha,beta
      <span class="dtype">real</span>*8          ZMBAR,RBAR,au,Rsun
<span class="comm">* astr. unit, solar radius, all in AU (1pc=206259.591AU)
</span>      parameter(au=206259.591D0,Rsun=4.6523D-3)
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">*==============================
</span><span class="comm">* Choose these to define the model: (alpha==lambda, beta==chi)
</span><span class="comm">*
</span><span class="comm">c      alpha = 10.D0
</span><span class="comm">c      beta = 1.D0
</span><span class="comm">* best values:
</span>      alpha = 28.D0
      beta = 0.75D0
<span class="comm">*==============================
</span><span class="comm">*
</span><span class="comm">*
</span><span class="comm">*
</span><span class="comm">* in Msun:
</span>      mtot = (mass1+mass2)*ZMBAR
      mtot_initial = mtot
<span class="comm">* in AU:
</span>      semi = semi*RBAR*au
<span class="comm">* in years:
</span>      period = semi*semi*semi/mtot
      period = DSQRT(period)
      ecc_initial = ecc
      period_initial = period
<span class="comm">*
</span><span class="comm">* 1) Circularisation and evolution of orbit as a function of
</span><span class="comm">* periastron distance  (Ro in AU):
</span><span class="comm">* Note that the algorithm used here leads to circularised orbits for
</span><span class="comm">* logP<=1 approximately!! (if beta=1.5,alpha=35 approximately)
</span>      Ro = alpha *Rsun
      R_periastron =  semi*(1.D0-ecc)
      alpha = -1.D0*(Ro/R_periastron)**beta
      <span class="kw">if</span> (ecc.GT.0.D0) <span class="kw">then</span>
         ecc = DEXP(alpha + DLOG(ecc))
      <span class="kw">else</span>
         ecc = ecc_initial
      <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span><span class="comm">* 2) Change mass-ratio towards unity as a function of initial periastron
</span><span class="comm">* distance:
</span><span class="comm">*
</span>      qold = mass1/mass2
      <span class="kw">if</span> (qold.GT.1.D0) qold = 1.D0/qold
      alpha = -1.D0*alpha
      <span class="kw">if</span> (alpha.GT.1.D0) <span class="kw">then</span>
         qnew = 1.D0
      <span class="kw">else</span>
         qnew = qold + (1.D0-qold) * alpha
      <span class="kw">end</span> <span class="kw">if</span>
<span class="comm">*
</span><span class="comm">* new masses in model units (remembering q=m1/m2<1) if mass is conserved
</span><span class="comm">* NOT IMPLEMENTED!
</span><span class="comm">c      mtot = mtot/ZMBAR
</span><span class="comm">c      mass1 = mtot/(qnew+1.D0)
</span><span class="comm">c      mass2 = mtot - mass1
</span><span class="comm">*
</span><span class="comm">* Keep the mass of primary fixed and adjust mass of secondary. Note that this
</span><span class="comm">* algorithm leads to a gain in mass of the binary, and thus of the whole
</span><span class="comm">* cluster!
</span><span class="comm">*
</span><span class="comm">C Added 20.06.96 write statements:
</span>        write(6,*)
        write(6,*)<span class="str">' FEEDING in binpop_pk.f'</span>
        write(6,<span class="str">'(a,2F8.3)'</span>)<span class="str">' old masses [Msun]:'</span>, 
                        mass1*ZMBAR,mass2*ZMBAR 
        mass1 = DMAX1(mass1,mass2)
        mass2 = qnew*mass1
        write(6,<span class="str">'(a,2F8.3)'</span>)<span class="str">' new masses [Msun]:'</span>, 
                        mass1*ZMBAR,mass2*ZMBAR 
<span class="comm">C End added bit.
</span><span class="comm">*
</span><span class="comm">* In Msun:
</span>        mtot = (mass1+mass2)*ZMBAR
<span class="comm">*
</span><span class="comm">C This below is wrong as in ecc formula above constant Rperi was assumed!!!
</span><span class="comm">c* Duquennoy et al. 1992 in "Binaries as tracers of stellar evolution":
</span><span class="comm">c      period = period_initial * DEXP((57.D0/14.D0) *
</span><span class="comm">c     & (ecc*ecc - ecc_initial*ecc_initial))
</span><span class="comm">C This below is correct:
</span>       period = period_initial*((1.D0-ecc_initial)/(1.D0-ecc))**1.5D0
       period = period * DSQRT(mtot_initial/mtot)
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">* New semi-major axis and back to model units:
</span>      semi = mtot * period*period
      semi = semi**(1.D0/3.D0)
      semi = semi/(RBAR*au)
<span class="comm">*
</span>      <span class="kw">return</span>
      <span class="kw">end</span>
<span class="comm">C=======================================================
</span>      <span class="kw">FUNCTION</span> <a href="function__gasdev_pk.html">gasdev_pk</a>(idum)
      <span class="dtype">INTEGER</span> idum
      <span class="dtype">REAL</span> <a href="function__gasdev_pk.html">gasdev_pk</a>
<span class="comm">CU    USES ran1
</span><span class="comm">C P.Kroupa: 8.11.96: changed to RAN2
</span>      <span class="dtype">INTEGER</span> iset
      <span class="dtype">REAL</span> fac,gset,rsq,v1,v2,<a href="function__ran2.html">ran2</a>
      SAVE iset,gset
      <a href="subroutine__DATA.html">DATA</a> iset/0/
      <span class="kw">if</span> (iset.eq.0) <span class="kw">then</span>
 1       v1=2.*<a href="function__ran2.html">ran2</a>(idum)-1.
        v2=2.*<a href="function__ran2.html">ran2</a>(idum)-1.
        rsq=v1**2+v2**2
        <span class="kw">if</span>(rsq.ge.1..or.rsq.eq.0.)<span class="kw">goto</span> 1
        fac=sqrt(-2.*log(rsq)/rsq)
        gset=v1*fac
        <a href="function__gasdev_pk.html">gasdev_pk</a>=v2*fac
        iset=1
      <span class="kw">else</span>
        <a href="function__gasdev_pk.html">gasdev_pk</a>=gset
        iset=0
      <span class="kw">endif</span>
      <span class="kw">return</span>
      <span class="kw">END</span>
</pre>
            
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
