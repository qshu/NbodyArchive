<html>
  <link REL="STYLESHEET" HREF="syntax.css" TYPE="text/css">
  <body>
    <table cellpadding="20" border="1">
      <thead>
        <tr>
        <td colspan="2"><center><h1>nbody6</h1></center>
<table width="100%">
  <tbody>
    <tr>
      <td width="30%" align="center"><a href="project__nbody6.html">Home</a></td>
      <td width="40%" align="center"><a href="call_project__nbody6.html">Call tree</a></td>
      <td width="30%" align="center"><a href="tree_project__nbody6.html">Structure tree</a></td>
    </tr>
  </tbody>
</table>

</td>
    </tr>
      </thead>
      <tbody>
        <tr>
          <td width="10%" align="left" valign="top"><ul>
  <li><a href="File__absorb.f.html">absorb.f</a></li>
</ul><ul>
  <li><a href="File__adjust.F.html">adjust.F</a></li>
</ul><ul>
  <li><a href="File__bindat.F.html">bindat.F</a></li>
</ul><ul>
  <li><a href="File__binout.f.html">binout.f</a></li>
</ul><ul>
  <li><a href="File__binpop.F.html">binpop.F</a></li>
</ul><ul>
  <li><a href="File__binpop_old.f.html">binpop_old.f</a></li>
</ul><ul>
  <li><a href="File__binpop_pk.f.html">binpop_pk.f</a></li>
</ul><ul>
  <li><a href="File__block.f.html">block.f</a></li>
</ul><ul>
  <li><a href="File__bodies.f.html">bodies.f</a></li>
</ul><ul>
  <li><a href="File__brake.f.html">brake.f</a></li>
</ul><ul>
  <li><a href="File__cfuncs.f.html">cfuncs.f</a></li>
</ul><ul>
  <li><a href="File__chain.f.html">chain.f</a></li>
</ul><ul>
  <li><a href="File__chdata.f.html">chdata.f</a></li>
</ul><ul>
  <li><a href="File__check.f.html">check.f</a></li>
</ul><ul>
  <li><a href="File__checkl.f.html">checkl.f</a></li>
</ul><ul>
  <li><a href="File__chfind.f.html">chfind.f</a></li>
</ul><ul>
  <li><a href="File__chfirr.f.html">chfirr.f</a></li>
</ul><ul>
  <li><a href="File__chinit.f.html">chinit.f</a></li>
</ul><ul>
  <li><a href="File__chlist.f.html">chlist.f</a></li>
</ul><ul>
  <li><a href="File__chmod.f.html">chmod.f</a></li>
</ul><ul>
  <li><a href="File__chpot.f.html">chpot.f</a></li>
</ul><ul>
  <li><a href="File__chstab.f.html">chstab.f</a></li>
</ul><ul>
  <li><a href="File__chterm.f.html">chterm.f</a></li>
</ul><ul>
  <li><a href="File__clint.f.html">clint.f</a></li>
</ul><ul>
  <li><a href="File__cloud.f.html">cloud.f</a></li>
</ul><ul>
  <li><a href="File__cloud0.F.html">cloud0.F</a></li>
</ul><ul>
  <li><a href="File__cmbody.f.html">cmbody.f</a></li>
</ul><ul>
  <li><a href="File__cmcorr.f.html">cmcorr.f</a></li>
</ul><ul>
  <li><a href="File__cmfirr.f.html">cmfirr.f</a></li>
</ul><ul>
  <li><a href="File__cmfreg.f.html">cmfreg.f</a></li>
</ul><ul>
  <li><a href="File__const.f.html">const.f</a></li>
</ul><ul>
  <li><a href="File__core.f.html">core.f</a></li>
</ul><ul>
  <li><a href="File__cputim.F.html">cputim.F</a></li>
</ul><ul>
  <li><a href="File__cstab2.f.html">cstab2.f</a></li>
</ul><ul>
  <li><a href="File__cstab3.f.html">cstab3.f</a></li>
</ul><ul>
  <li><a href="File__cstab4.f.html">cstab4.f</a></li>
</ul><ul>
  <li><a href="File__cstab5.f.html">cstab5.f</a></li>
</ul><ul>
  <li><a href="File__data.F.html">data.F</a></li>
</ul><ul>
  <li><a href="File__define.f.html">define.f</a></li>
</ul><ul>
  <li><a href="File__delay.f.html">delay.f</a></li>
</ul><ul>
  <li><a href="File__derqp.f.html">derqp.f</a></li>
</ul><ul>
  <li><a href="File__derqp3.f.html">derqp3.f</a></li>
</ul><ul>
  <li><a href="File__derqp4.f.html">derqp4.f</a></li>
</ul><ul>
  <li><a href="File__difsy1.f.html">difsy1.f</a></li>
</ul><ul>
  <li><a href="File__difsy3.f.html">difsy3.f</a></li>
</ul><ul>
  <li><a href="File__difsy4.f.html">difsy4.f</a></li>
</ul><ul>
  <li><a href="File__efac2.f.html">efac2.f</a></li>
</ul><ul>
  <li><a href="File__efac3.f.html">efac3.f</a></li>
</ul><ul>
  <li><a href="File__eigenvalue.f.html">eigenvalue.f</a></li>
</ul><ul>
  <li><a href="File__ellan.f.html">ellan.f</a></li>
</ul><ul>
  <li><a href="File__endreg.f.html">endreg.f</a></li>
</ul><ul>
  <li><a href="File__energy.f.html">energy.f</a></li>
</ul><ul>
  <li><a href="File__energy_mpi.f.html">energy_mpi.f</a></li>
</ul><ul>
  <li><a href="File__erel.f.html">erel.f</a></li>
</ul><ul>
  <li><a href="File__erel3.f.html">erel3.f</a></li>
</ul><ul>
  <li><a href="File__erel4.f.html">erel4.f</a></li>
</ul><ul>
  <li><a href="File__escape.F.html">escape.F</a></li>
</ul><ul>
  <li><a href="File__events.f.html">events.f</a></li>
</ul><ul>
  <li><a href="File__evolve.f.html">evolve.f</a></li>
</ul><ul>
  <li><a href="File__expand.f.html">expand.f</a></li>
</ul><ul>
  <li><a href="File__extend.f.html">extend.f</a></li>
</ul><ul>
  <li><a href="File__fchain.f.html">fchain.f</a></li>
</ul><ul>
  <li><a href="File__fclose.f.html">fclose.f</a></li>
</ul><ul>
  <li><a href="File__fcloud.f.html">fcloud.f</a></li>
</ul><ul>
  <li><a href="File__fcorr.f.html">fcorr.f</a></li>
</ul><ul>
  <li><a href="File__ficorr.f.html">ficorr.f</a></li>
</ul><ul>
  <li><a href="File__file_init.F.html">file_init.F</a></li>
</ul><ul>
  <li><a href="File__findj.f.html">findj.f</a></li>
</ul><ul>
  <li><a href="File__flush.f.html">flush.f</a></li>
</ul><ul>
  <li><a href="File__flush.t3e.f.html">flush.t3e.f</a></li>
</ul><ul>
  <li><a href="File__flyby.f.html">flyby.f</a></li>
</ul><ul>
  <li><a href="File__fpcorr.f.html">fpcorr.f</a></li>
</ul><ul>
  <li><a href="File__fpert.f.html">fpert.f</a></li>
</ul><ul>
  <li><a href="File__fpoly1.f.html">fpoly1.f</a></li>
</ul><ul>
  <li><a href="File__fpoly1_mpi.f.html">fpoly1_mpi.f</a></li>
</ul><ul>
  <li><a href="File__fpoly2.f.html">fpoly2.f</a></li>
</ul><ul>
  <li><a href="File__fpoly2_mpi.f.html">fpoly2_mpi.f</a></li>
</ul><ul>
  <li><a href="File__freeze.f.html">freeze.f</a></li>
</ul><ul>
  <li><a href="File__ghost.f.html">ghost.f</a></li>
</ul><ul>
  <li><a href="File__gntage.f.html">gntage.f</a></li>
</ul><ul>
  <li><a href="File__hcorr.f.html">hcorr.f</a></li>
</ul><ul>
  <li><a href="File__hiarch.f.html">hiarch.f</a></li>
</ul><ul>
  <li><a href="File__hidat.f.html">hidat.f</a></li>
</ul><ul>
  <li><a href="File__himax.f.html">himax.f</a></li>
</ul><ul>
  <li><a href="File__himax2.f.html">himax2.f</a></li>
</ul><ul>
  <li><a href="File__hipop.F.html">hipop.F</a></li>
</ul><ul>
  <li><a href="File__histab.f.html">histab.f</a></li>
</ul><ul>
  <li><a href="File__hivel.f.html">hivel.f</a></li>
</ul><ul>
  <li><a href="File__hmdot.f.html">hmdot.f</a></li>
</ul><ul>
  <li><a href="File__hmdot2.f.html">hmdot2.f</a></li>
</ul><ul>
  <li><a href="File__hotsys.F.html">hotsys.F</a></li>
</ul><ul>
  <li><a href="File__hpsort.f.html">hpsort.f</a></li>
</ul><ul>
  <li><a href="File__hrdiag.f.html">hrdiag.f</a></li>
</ul><ul>
  <li><a href="File__hrplot.f.html">hrplot.f</a></li>
</ul><ul>
  <li><a href="File__iblock.f.html">iblock.f</a></li>
</ul><ul>
  <li><a href="File__ichain.f.html">ichain.f</a></li>
</ul><ul>
  <li><a href="File__imf.f.html">imf.f</a></li>
</ul><ul>
  <li><a href="File__imf2.f.html">imf2.f</a></li>
</ul><ul>
  <li><a href="File__imfbd.f.html">imfbd.f</a></li>
</ul><ul>
  <li><a href="File__impact.f.html">impact.f</a></li>
</ul><ul>
  <li><a href="File__inclin.f.html">inclin.f</a></li>
</ul><ul>
  <li><a href="File__indexx.f.html">indexx.f</a></li>
</ul><ul>
  <li><a href="File__inext.f.html">inext.f</a></li>
</ul><ul>
  <li><a href="File__input.F.html">input.F</a></li>
</ul><ul>
  <li><a href="File__insert.f.html">insert.f</a></li>
</ul><ul>
  <li><a href="File__instar.f.html">instar.f</a></li>
</ul><ul>
  <li><a href="File__intgrt.F.html">intgrt.F</a></li>
</ul><ul>
  <li><a href="File__intide.F.html">intide.F</a></li>
</ul><ul>
  <li><a href="File__invert.f.html">invert.f</a></li>
</ul><ul>
  <li><a href="File__kcpert.f.html">kcpert.f</a></li>
</ul><ul>
  <li><a href="File__kepler.f.html">kepler.f</a></li>
</ul><ul>
  <li><a href="File__kick.f.html">kick.f</a></li>
</ul><ul>
  <li><a href="File__ksapo.f.html">ksapo.f</a></li>
</ul><ul>
  <li><a href="File__kscorr.f.html">kscorr.f</a></li>
</ul><ul>
  <li><a href="File__ksin2.f.html">ksin2.f</a></li>
</ul><ul>
  <li><a href="File__ksinit.f.html">ksinit.f</a></li>
</ul><ul>
  <li><a href="File__ksint.F.html">ksint.F</a></li>
</ul><ul>
  <li><a href="File__kslist.f.html">kslist.f</a></li>
</ul><ul>
  <li><a href="File__ksmod.f.html">ksmod.f</a></li>
</ul><ul>
  <li><a href="File__ksperi.f.html">ksperi.f</a></li>
</ul><ul>
  <li><a href="File__kspert.f.html">kspert.f</a></li>
</ul><ul>
  <li><a href="File__ksphys.f.html">ksphys.f</a></li>
</ul><ul>
  <li><a href="File__kspoly.f.html">kspoly.f</a></li>
</ul><ul>
  <li><a href="File__kspred.f.html">kspred.f</a></li>
</ul><ul>
  <li><a href="File__ksrect.f.html">ksrect.f</a></li>
</ul><ul>
  <li><a href="File__ksreg.f.html">ksreg.f</a></li>
</ul><ul>
  <li><a href="File__ksres.f.html">ksres.f</a></li>
</ul><ul>
  <li><a href="File__ksres2.f.html">ksres2.f</a></li>
</ul><ul>
  <li><a href="File__ksterm.f.html">ksterm.f</a></li>
</ul><ul>
  <li><a href="File__kstide.f.html">kstide.f</a></li>
</ul><ul>
  <li><a href="File__lagr.F.html">lagr.F</a></li>
</ul><ul>
  <li><a href="File__levels.f.html">levels.f</a></li>
</ul><ul>
  <li><a href="File__matrix.f.html">matrix.f</a></li>
</ul><ul>
  <li><a href="File__mdot.f.html">mdot.f</a></li>
</ul><ul>
  <li><a href="File__merge.f.html">merge.f</a></li>
</ul><ul>
  <li><a href="File__merge2.f.html">merge2.f</a></li>
</ul><ul>
  <li><a href="File__mloss.f.html">mloss.f</a></li>
</ul><ul>
  <li><a href="File__mlwind.f.html">mlwind.f</a></li>
</ul><ul>
  <li><a href="File__modify.F.html">modify.F</a></li>
</ul><ul>
  <li><a href="File__mydump.F.html">mydump.F</a></li>
</ul><ul>
  <li><a href="File__nbint.f.html">nbint.f</a></li>
</ul><ul>
  <li><a href="File__nblist.f.html">nblist.f</a></li>
</ul><ul>
  <li><a href="File__nbody6.F.html">nbody6.F</a></li>
</ul><ul>
  <li><a href="File__nbpot.f.html">nbpot.f</a></li>
</ul><ul>
  <li><a href="File__nbrem.f.html">nbrem.f</a></li>
</ul><ul>
  <li><a href="File__nbrest.f.html">nbrest.f</a></li>
</ul><ul>
  <li><a href="File__nbsort.f.html">nbsort.f</a></li>
</ul><ul>
  <li><a href="File__nbtide.f.html">nbtide.f</a></li>
</ul><ul>
  <li><a href="File__newreg.f.html">newreg.f</a></li>
</ul><ul>
  <li><a href="File__newsys.f.html">newsys.f</a></li>
</ul><ul>
  <li><a href="File__nlmod.f.html">nlmod.f</a></li>
</ul><ul>
  <li><a href="File__offset.f.html">offset.f</a></li>
</ul><ul>
  <li><a href="File__orbit.f.html">orbit.f</a></li>
</ul><ul>
  <li><a href="File__output.F.html">output.F</a></li>
</ul><ul>
  <li><a href="File__peri.f.html">peri.f</a></li>
</ul><ul>
  <li><a href="File__permit.f.html">permit.f</a></li>
</ul><ul>
  <li><a href="File__pfac.f.html">pfac.f</a></li>
</ul><ul>
  <li><a href="File__physks.f.html">physks.f</a></li>
</ul><ul>
  <li><a href="File__qforce.f.html">qforce.f</a></li>
</ul><ul>
  <li><a href="File__qpmod.f.html">qpmod.f</a></li>
</ul><ul>
  <li><a href="File__qpmod3.f.html">qpmod3.f</a></li>
</ul><ul>
  <li><a href="File__qpmod4.f.html">qpmod4.f</a></li>
</ul><ul>
  <li><a href="File__quad.f.html">quad.f</a></li>
</ul><ul>
  <li><a href="File__r2sort.f.html">r2sort.f</a></li>
</ul><ul>
  <li><a href="File__ran2.f.html">ran2.f</a></li>
</ul><ul>
  <li><a href="File__rchain.f.html">rchain.f</a></li>
</ul><ul>
  <li><a href="File__recoil.f.html">recoil.f</a></li>
</ul><ul>
  <li><a href="File__redraw.f.html">redraw.f</a></li>
</ul><ul>
  <li><a href="File__reduce.f.html">reduce.f</a></li>
</ul><ul>
  <li><a href="File__reflct.f.html">reflct.f</a></li>
</ul><ul>
  <li><a href="File__regint.f.html">regint.f</a></li>
</ul><ul>
  <li><a href="File__reinit.f.html">reinit.f</a></li>
</ul><ul>
  <li><a href="File__remove.f.html">remove.f</a></li>
</ul><ul>
  <li><a href="File__rename.f.html">rename.f</a></li>
</ul><ul>
  <li><a href="File__renew.f.html">renew.f</a></li>
</ul><ul>
  <li><a href="File__reset.f.html">reset.f</a></li>
</ul><ul>
  <li><a href="File__reset2.f.html">reset2.f</a></li>
</ul><ul>
  <li><a href="File__resolv.f.html">resolv.f</a></li>
</ul><ul>
  <li><a href="File__resort.f.html">resort.f</a></li>
</ul><ul>
  <li><a href="File__rsort.f.html">rsort.f</a></li>
</ul><ul>
  <li><a href="File__rssort.f.html">rssort.f</a></li>
</ul><ul>
  <li><a href="File__scale.F.html">scale.F</a></li>
</ul><ul>
  <li><a href="File__search.f.html">search.f</a></li>
</ul><ul>
  <li><a href="File__select.f.html">select.f</a></li>
</ul><ul>
  <li><a href="File__setsys.f.html">setsys.f</a></li>
</ul><ul>
  <li><a href="File__setup.f.html">setup.f</a></li>
</ul><ul>
  <li><a href="File__short.f.html">short.f</a></li>
</ul><ul>
  <li><a href="File__shrink.f.html">shrink.f</a></li>
</ul><ul>
  <li><a href="File__slow.f.html">slow.f</a></li>
</ul><ul>
  <li><a href="File__sort1.f.html">sort1.f</a></li>
</ul><ul>
  <li><a href="File__sort3.f.html">sort3.f</a></li>
</ul><ul>
  <li><a href="File__stabl3.f.html">stabl3.f</a></li>
</ul><ul>
  <li><a href="File__stabl4.f.html">stabl4.f</a></li>
</ul><ul>
  <li><a href="File__stablc.f.html">stablc.f</a></li>
</ul><ul>
  <li><a href="File__stablz.f.html">stablz.f</a></li>
</ul><ul>
  <li><a href="File__star.f.html">star.f</a></li>
</ul><ul>
  <li><a href="File__start.F.html">start.F</a></li>
</ul><ul>
  <li><a href="File__start3.f.html">start3.f</a></li>
</ul><ul>
  <li><a href="File__start4.f.html">start4.f</a></li>
</ul><ul>
  <li><a href="File__status.f.html">status.f</a></li>
</ul><ul>
  <li><a href="File__stepi.f.html">stepi.f</a></li>
</ul><ul>
  <li><a href="File__stepk.f.html">stepk.f</a></li>
</ul><ul>
  <li><a href="File__steps.f.html">steps.f</a></li>
</ul><ul>
  <li><a href="File__stumpf.f.html">stumpf.f</a></li>
</ul><ul>
  <li><a href="File__subint.f.html">subint.f</a></li>
</ul><ul>
  <li><a href="File__subsys.f.html">subsys.f</a></li>
</ul><ul>
  <li><a href="File__swcond.f.html">swcond.f</a></li>
</ul><ul>
  <li><a href="File__switch.f.html">switch.f</a></li>
</ul><ul>
  <li><a href="File__tchain.f.html">tchain.f</a></li>
</ul><ul>
  <li><a href="File__tcirc.f.html">tcirc.f</a></li>
</ul><ul>
  <li><a href="File__tides.f.html">tides.f</a></li>
</ul><ul>
  <li><a href="File__tperi.f.html">tperi.f</a></li>
</ul><ul>
  <li><a href="File__tpert.f.html">tpert.f</a></li>
</ul><ul>
  <li><a href="File__trans3.f.html">trans3.f</a></li>
</ul><ul>
  <li><a href="File__trans4.f.html">trans4.f</a></li>
</ul><ul>
  <li><a href="File__transk.f.html">transk.f</a></li>
</ul><ul>
  <li><a href="File__transq.f.html">transq.f</a></li>
</ul><ul>
  <li><a href="File__transx.f.html">transx.f</a></li>
</ul><ul>
  <li><a href="File__triple.f.html">triple.f</a></li>
</ul><ul>
  <li><a href="File__tstep.f.html">tstep.f</a></li>
</ul><ul>
  <li><a href="File__units.f.html">units.f</a></li>
</ul><ul>
  <li><a href="File__unpert.f.html">unpert.f</a></li>
</ul><ul>
  <li><a href="File__update.f.html">update.f</a></li>
</ul><ul>
  <li><a href="File__vector.f.html">vector.f</a></li>
</ul><ul>
  <li><a href="File__verify.f.html">verify.f</a></li>
</ul><ul>
  <li><a href="File__xcpred.f.html">xcpred.f</a></li>
</ul><ul>
  <li><a href="File__xtf.f.html">xtf.f</a></li>
</ul><ul>
  <li><a href="File__xtpert.f.html">xtpert.f</a></li>
</ul><ul>
  <li><a href="File__xtrnl0.f.html">xtrnl0.f</a></li>
</ul><ul>
  <li><a href="File__xtrnld.f.html">xtrnld.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlf.f.html">xtrnlf.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlp.f.html">xtrnlp.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlu.f.html">xtrnlu.f</a></li>
</ul><ul>
  <li><a href="File__xtrnlv.f.html">xtrnlv.f</a></li>
</ul><ul>
  <li><a href="File__xvpred.f.html">xvpred.f</a></li>
</ul><ul>
  <li><a href="File__ycopy.f.html">ycopy.f</a></li>
</ul><ul>
  <li><a href="File__ysave.f.html">ysave.f</a></li>
</ul><ul>
  <li><a href="File__zare.f.html">zare.f</a></li>
</ul><ul>
  <li><a href="File__zcnsts.f.html">zcnsts.f</a></li>
</ul><ul>
  <li><a href="File__zdata.f.html">zdata.f</a></li>
</ul><ul>
  <li><a href="File__zero.f.html">zero.f</a></li>
</ul><ul>
  <li><a href="File__zfuncs.f.html">zfuncs.f</a></li>
</ul>
</td>
          <td width="90%" valign="top">
            <h2><b>subroutine</b>:<i>ESCAPE</i></h2><br>
            <h3>      SUBROUTINE ESCAPE
</h3>
            Author:<i></i><br>
            Version:<i></i><br>
            <p>Belongs to: <a href="File__escape.F.html">escape.F</a></p>
            <p>Located at: <a href="File__escape.F.html">escape.F</a></p>
            <div>Uses:
              <ul>
                <li><a href="subroutine__CHFIND.html">CHFIND</a> at <a href="File__chfind.f.html">chfind.f</a></li>
              </ul><ul>
                <li><a href="subroutine__HIARCH.html">HIARCH</a> at <a href="File__hiarch.f.html">hiarch.f</a></li>
              </ul><ul>
                <li><a href="subroutine__NLMOD.html">NLMOD</a> at <a href="File__nlmod.f.html">nlmod.f</a></li>
              </ul><ul>
                <li><a href="subroutine__QUAD.html">QUAD</a> at <a href="File__quad.f.html">quad.f</a></li>
              </ul><ul>
                <li><a href="subroutine__REMOVE.html">REMOVE</a> at <a href="File__remove.f.html">remove.f</a></li>
              </ul><ul>
                <li><a href="function__STEPI.html">STEPI</a> at <a href="File__stepi.f.html">stepi.f</a></li>
              </ul><ul>
                <li><a href="subroutine__XTRNLV.html">XTRNLV</a> at <a href="File__xtrnlv.f.html">xtrnlv.f</a></li>
              </ul>
            </div>
            <div>Used by:
              <ul>
                <li><a href="subroutine__ADJUST.html">ADJUST</a> at <a href="File__adjust.F.html">adjust.F</a></li>
              </ul>
            </div>
            <tt>
<br>
<br>       Escaper removal.
<br>       ----------------
<br>
</tt>
            
            <h3>Variables</h3>
            <table border="1">
              <tr><td>WHICH1</td><td>CHARACTER*11</td><td></td><td></td></tr>
            </table>
            <pre class="source">      <span class="kw">SUBROUTINE</span> <a href="subroutine__ESCAPE.html">ESCAPE</a>
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">*       Escaper removal.
</span><span class="comm">*       ----------------
</span><span class="comm">*
</span>      <span class="kw">INCLUDE</span> <span class="str">'common6.h'</span>
      <span class="kw">COMMON</span>/BINARY/  CM(4,MMAX),XREL(3,MMAX),VREL(3,MMAX),
                HM(MMAX),UM(4,MMAX),UMDOT(4,MMAX),
                NAMEM(MMAX),NAMEG(MMAX),KSTARM(MMAX)
      <span class="dtype">CHARACTER</span>*11  WHICH1
<span class="comm">*
</span><span class="comm">*
</span><span class="comm">*       Adopt twice the tidal radius as escape condition.
</span>      RESC2 = 4.0*RTIDE**2
<span class="comm">*       For tidal cutoff check only energy
</span>      <span class="kw">IF</span>(KZ(23).GE.3)<span class="kw">THEN</span>
          RESC2 = 0.D0
          ETID = ZMASS/RTIDE
          ZMOLD = ZMASS
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>      RTIDE2 = RTIDE**2
      NCORR = 0
      NCRIT1 = 0
      NCRIT2 = 0
      I3HI = 0
      <span class="kw">DO</span> 1 K = 1,3
          CMR(K) = 0.0D0
          CMRDOT(K) = 0.0D0
    1 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Set the distance (squared) with respect to the density centre.
</span>      I = IFIRST
    5 RI2 = (X(1,I) - RDENS(1))**2 + (X(2,I) - RDENS(2))**2 + 
                               (X(3,I) - RDENS(3))**2
      <span class="kw">IF</span> (RI2.LT.RTIDE2) NCRIT1 = NCRIT1 + 1
<span class="comm">*
</span>      <span class="kw">IF</span>(KZ(23).LE.2) <span class="kw">THEN</span>
<span class="comm">*       See whether escape is indicated (retain ghost particles).
</span>      <span class="kw">IF</span> (RI2.GT.RESC2.AND.RI2.LT.1.0D+10) <span class="kw">THEN</span>
          RJMIN2 = 1.0D+10
<span class="comm">*       Find distance to the nearest neighbour and calculate potential.
</span>          POTI = 0.0D0
          <span class="kw">DO</span> 8 J = IFIRST,NTOT
              <span class="kw">IF</span> (J.EQ.I) GO TO 8
              RIJ2 = (X(1,I) - X(1,J))**2 + (X(2,I) - X(2,J))**2 +
                                      (X(3,I) - X(3,J))**2
              POTI = POTI + BODY(J)/SQRT(RIJ2)
              <span class="kw">IF</span> (RIJ2.LT.RJMIN2) <span class="kw">THEN</span>
                  RJMIN2 = RIJ2
                  JMIN = J
              <span class="kw">END</span> <span class="kw">IF</span>
    8     <span class="kw">CONTINUE</span>
          VI2 = XDOT(1,I)**2 + XDOT(2,I)**2 + XDOT(3,I)**2
<span class="comm">*       Check escape criterion for tidal case or isolated system.
</span>          EI = 0.5*VI2 - POTI
          <span class="kw">IF</span> (KZ(14).GT.0.OR.EI.GT.0.0) GO TO 30
          <span class="kw">IF</span> (NAME(I).LT.0) GO TO 30
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>      <span class="kw">ELSE</span>
<span class="comm">*       Check tidal cutoff criterion - use last computed phi-value
</span><span class="comm">*       Find distance to the nearest neighbour
</span>          POTI = 0.0D0
          NNB = LIST(1,I)
          RJMIN2 = 1.0D+10
          <span class="kw">DO</span> 9 L = 1,NNB
              J = LIST(L+1,I)
              RIJ2 = (X(1,I) - X(1,J))**2 + (X(2,I) - X(2,J))**2 +
                                      (X(3,I) - X(3,J))**2
              <span class="kw">IF</span> (RIJ2.LT.RJMIN2) <span class="kw">THEN</span>
                  RJMIN2 = RIJ2
                  JMIN = J
              <span class="kw">END</span> <span class="kw">IF</span>
    9     <span class="kw">CONTINUE</span>
          VI2 = XDOT(1,I)**2 + XDOT(2,I)**2 + XDOT(3,I)**2
          POTI = -PHIDBL(I)
<span class="comm">*       Check escape criterion for tidal case or isolated system.
</span>          EI = 0.5*VI2 - POTI + ETID
<span class="comm">*
</span>          <span class="kw">IF</span> (EI.GT.0.0.AND.RI2.GT.RTIDE2) <span class="kw">THEN</span>
          NCRIT2 = NCRIT2 + 1
          GO TO 30
          <span class="kw">END</span> <span class="kw">IF</span>
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>   10 I = I + 1
   12 <span class="kw">IF</span> (N.EQ.2) GO TO 13
<span class="comm">*
</span>      <span class="kw">IF</span> (I.LE.NTOT) GO TO 5
      <span class="kw">IF</span> (NCORR.EQ.0) GO TO 25
<span class="comm">*
</span><span class="comm">*       Form centre of mass terms.
</span>   13 <span class="kw">DO</span> 15 I = 1,N
          <span class="kw">DO</span> 14 K = 1,3
              CMR(K) = CMR(K) + BODY(I)*X(K,I)/ZMASS
              CMRDOT(K) = CMRDOT(K) + BODY(I)*XDOT(K,I)/ZMASS
   14     <span class="kw">CONTINUE</span>
   15 <span class="kw">CONTINUE</span>
      CMR(4) = SQRT(CMR(1)**2 + CMR(2)**2 + CMR(3)**2)
<span class="comm">*
</span>      JLAST = MIN(2*NCORR,NMAX)
      <span class="kw">if</span>(rank.eq.0)
WRITE (6,18)  N, NSESC, NBESC, ZMASS, BE(3), CMR(4), RESC, <a href="function__STEPI.html">STEPI</a>,
              RSI, ZMASS/FLOAT(N), NCRIT1, (JLIST(J),J=1,JLAST)
   18 <span class="kw">FORMAT</span> (/,<span class="str">' ESCAPE    N ='</span>,2I6,I4,F8.4,F12.6,2F7.2,F7.3,F7.2,F9.5,
                                        I6,2X,6I6,/,5(10X,20I6,/))
<span class="comm">*
</span>      <span class="kw">IF</span> (KZ(23).EQ.2.OR.KZ(23).EQ.4)<span class="kw">THEN</span>
          JLAST = MIN(2*NCORR,NMAX)
          <span class="kw">if</span>(rank.eq.0) WRITE (6,20)  (ILIST(J),J=1,JLAST)
   20     <span class="kw">FORMAT</span> (/,<span class="str">' ESCAPE ANGLES '</span>,11(2I4,2X),9(/,15X,11(2I4,2X)))
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Check updating of global index for chain c.m.
</span>      <span class="kw">IF</span> (NCH.GT.0) <span class="kw">THEN</span>
          <span class="kw">CALL</span> <a href="subroutine__CHFIND.html">CHFIND</a>
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Set phase indicator < 0 for new NLIST in routine INTGRT (Hermite).
</span>      IPHASE = -1
<span class="comm">*
</span>   25 <span class="kw">RETURN</span>
<span class="comm">*
</span>   30 A2 = (X(1,JMIN) - RDENS(1))**2 + (X(2,JMIN) - RDENS(2))**2 +
                                 (X(3,JMIN) - RDENS(3))**2
<span class="comm">*       See whether nearest body satisfies escape condition or RIJ > 10*RMIN.
</span>      <span class="kw">IF</span> (A2.GT.RESC2.AND.KZ(14).GT.0) GO TO 40
      <span class="kw">IF</span> (RJMIN2.GT.100.0*RMIN2) GO TO 40
<span class="comm">*
</span>      <span class="kw">IF</span>(KZ(23).GE.3)<span class="kw">THEN</span>
          VI2 = XDOT(1,JMIN)**2 + XDOT(2,JMIN)**2 + XDOT(3,JMIN)**2
          EI = 0.5*VI2 + PHIDBL(JMIN) + ETID
          <span class="kw">IF</span>(EI.GT.0.D0) GO TO 40
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>      A3 = XDOT(1,JMIN)**2 + XDOT(2,JMIN)**2 + XDOT(3,JMIN)**2
      A4 = (XDOT(1,I) - XDOT(1,JMIN))**2 +
     (XDOT(2,I) - XDOT(2,JMIN))**2 +
     (XDOT(3,I) - XDOT(3,JMIN))**2
      A5 = (BODY(I) + BODY(JMIN))/SQRT(RJMIN2)
<span class="comm">*       Check velocity of binary component in case of bound pair.
</span>      A6 = 2.0*A5/A4
      <span class="kw">IF</span> (A6.GT.1.0.AND.A3.GT.2.0*ZMASS/SQRT(A2)) GO TO 40
<span class="comm">*       Retain escaper if dynamical effect on neighbour is significant.
</span>      <span class="kw">IF</span> (A6.GT.0.01) GO TO 10
<span class="comm">*
</span><span class="comm">*       Form optional output diagnostics.
</span>   40 X1 = X(1,I) - RDENS(1)
      Y1 = X(2,I) - RDENS(2)
      Z1 = X(3,I) - RDENS(3)
      A3 = ABS(Y1/X1)
      A4 = ABS(Z1)/SQRT(X1**2 + Y1**2)
      ILIST(2*NCORR+1) = DATAN(A3)*180.0/3.14159
      ILIST(2*NCORR+2) = DATAN(A4)*180.0/3.14159
<span class="comm">*       Escape angles with respect to the X-axis and XY-plane.
</span>      RESC = SQRT(RI2)
      <a href="function__STEPI.html">STEPI</a> = STEP(I)
      RSI = RS(I)
<span class="comm">*
</span><span class="comm">*       Accumulate escaper names and save current name in case I > N.
</span>      NCORR = NCORR + 1
      JLIST(NCORR) = NAME(I)
      NAMEI = NAME(I)
      KSTARI = KSTAR(I)
      <span class="kw">IF</span> (NAME(I).LT.0) KSTARI = KSTARI + 30
      <span class="kw">IF</span> (BODY(I).LE.0.0D0) GO TO 50
<span class="comm">*
</span><span class="comm">*       Obtain binding energy of body #I and update optional tidal radius.
</span>      ZK = 0.5D0*BODY(I)*VI2
      <span class="kw">IF</span> (KZ(14).GT.0) <span class="kw">THEN</span>
          <span class="kw">CALL</span> <a href="subroutine__XTRNLV.html">XTRNLV</a>(I,I)
          ZK = ZK + HT
          RTIDE = (ZMASS/TIDAL(1))**0.3333
      <span class="kw">END</span> <span class="kw">IF</span>
      EI = ZK - BODY(I)*POTI
<span class="comm">*
</span><span class="comm">*       Update tidal radius in case of tidal cutoff (R.Sp.)
</span>      <span class="kw">IF</span>(KZ(23).GE.3)<span class="kw">THEN</span>
          RTOLD = RTIDE
          RTIDE = RTIDE*(ZMASS/ZMOLD)**0.3333
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Correct total energy.
</span>      BE(3) = BE(3) - EI
<span class="comm">*
</span><span class="comm">*       Update total mass and save energy & number of single escapers.
</span>      <span class="kw">IF</span> (I.LE.N) <span class="kw">THEN</span>
          ZMASS = ZMASS - BODY(I)
          E(4) = E(4) + EI
          NPOP(4) = NPOP(4) + 1
          NSESC = NSESC + 1
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Include optional escape output on unit 11.
</span>      <span class="kw">IF</span> (KZ(23).EQ.2.OR.KZ(23).EQ.4) <span class="kw">THEN</span>
          TESC = TSCALE*TTOT
          EESC = EI/BODY(I)
          VB2 = 2.0*ZKIN/ZMASS
<span class="comm">*       Distinguish between tidal field and isolated system (ECRIT at RTIDE).
</span>          <span class="kw">IF</span> (KZ(14).GT.0) <span class="kw">THEN</span>
              ECRIT = -1.5*(TIDAL(1)*ZMASS**2)**0.3333
              EESC = 2.0*(EESC - ECRIT)/VB2
              EESC = MIN(EESC,999.0D0)
              BESC = ZMBAR*BODY(I)
          <span class="kw">ELSE</span>
              EESC = 2.0*EESC/VB2
              BESC = BODY(I)/BODYM
          <span class="kw">END</span> <span class="kw">IF</span>
          VKM = SQRT(VI2)*VSTAR
<span class="prep">#ifdef PARALLEL
</span>      <span class="kw">if</span>(rank.eq.0)<span class="kw">then</span>
<span class="prep">#endif
</span>          WRITE (11,45)  TESC, BESC, EESC, VKM, KSTARI
   45     <span class="kw">FORMAT</span> (F8.1,3F6.1,I4)
<span class="prep">#ifdef PARALLEL
</span>      <span class="kw">end</span> <span class="kw">if</span>
<span class="prep">#endif
</span>      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Reduce particle number & total membership and check NNBMAX.
</span>   50 N = N - 1
      NTOT = NTOT - 1
      NNBMAX = MIN(N/2,NNBMAX)
      ZNBMAX = 0.9*FLOAT(NNBMAX)
      ZNBMIN = MAX(0.01*FLOAT(NNBMAX),1.0)
<span class="comm">*       Set indicator for removal of c.m. or KS components.
</span>      KCASE = 1
<span class="comm">*
</span><span class="comm">*       Update COMMON arrays to remove the escaper and correct F & FDOT.
</span>      <span class="kw">CALL</span> <a href="subroutine__REMOVE.html">REMOVE</a>(I,1)
<span class="comm">*
</span><span class="comm">*       Delete escaper from neighbour lists and reduce higher locations.
</span>   60 <span class="kw">DO</span> 150 J = 1,NTOT
          NNB = LIST(1,J)
          <span class="kw">IF</span> (NNB.EQ.0) GO TO 150
          L = 2
   70     <span class="kw">IF</span> (LIST(L,J).NE.I) GO TO 130
<span class="comm">*
</span><span class="comm">*       Move up the remaining list members and reduce membership by one.
</span>          <span class="kw">DO</span> 80 K = L,NNB
              LIST(K,J) = LIST(K+1,J)
   80     <span class="kw">CONTINUE</span>
          LIST(1,J) = LIST(1,J) - 1
<span class="comm">*       Reduce the steps to minimize error effect (do not allow DT < 0).
</span><span class="comm">*         STEP(J) = MAX(0.5D0*STEP(J),TIME - T0(J))
</span><span class="comm">*         STEPR(J) = MAX(0.5D0*STEPR(J),TIME - T0R(J))
</span><span class="comm">*       Add body #J to time-step list unless already a member. 
</span><span class="comm">*         IF (T0(J) + STEP(J).LT.TLIST) THEN
</span><span class="comm">*             CALL NLMOD(J,1)
</span><span class="comm">*         END IF
</span>          <span class="kw">IF</span> (LIST(1,J).GT.0) GO TO 130
<span class="comm">*
</span><span class="comm">*       Add a distant body as neighbour if list only contains escaper.
</span>          K = IFIRST - 1
  100     K = K + 1
          RJK2 = (X(1,J) - X(1,K))**2 + (X(2,J) - X(2,K))**2 +
                                  (X(3,J) - X(3,K))**2
          <span class="kw">IF</span> (RJK2.LT.RESC2.AND.K.LT.N) GO TO 100
          LIST(1,J) = 1
          LIST(2,J) = K
          GO TO 150
<span class="comm">*
</span><span class="comm">*       Reduce higher particle locations by one.
</span>  130     <span class="kw">IF</span> (LIST(L,J).GT.I) LIST(L,J) = LIST(L,J) - 1
          L = L + 1
          <span class="kw">IF</span> (L.LE.LIST(1,J) + 1) GO TO 70
  150 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Modify time-step list due to escaper removal (-2 for extra test).
</span>      <span class="kw">CALL</span> <a href="subroutine__NLMOD.html">NLMOD</a>(I,-2)
<span class="comm">*
</span><span class="comm">*       Update list of old KS components (remove #I and rename > I).
</span>      NNB = LISTR(1)
      <span class="kw">DO</span> 170 L = 2,NNB+1
          <span class="kw">IF</span> (LISTR(L).EQ.I) <span class="kw">THEN</span>
<span class="comm">*       Remove both components of pair and reduce membership by two.
</span>              J = 2*KVEC(L-1)
              <span class="kw">DO</span> 165 K = J,NNB-1
                  LISTR(K) = LISTR(K+2)
  165         <span class="kw">CONTINUE</span>
              LISTR(1) = LISTR(1) - 2
          <span class="kw">END</span> <span class="kw">IF</span>
  170 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Reduce higher particle locations by one (separate loop for pairs).
</span>      <span class="kw">DO</span> 180 L = 2,NNB+1
          <span class="kw">IF</span> (LISTR(L).GT.I) LISTR(L) = LISTR(L) - 1
  180 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Update list of high velocity particles (remove #I and rename > I).
</span>      NNB = LISTV(1)
      <span class="kw">DO</span> 190 L = 2,NNB+1
          <span class="kw">IF</span> (LISTV(L).EQ.I) <span class="kw">THEN</span>
<span class="comm">*       Remove escaper and reduce the membership.
</span>              <span class="kw">DO</span> 185 K = L,NNB
                  LISTV(K) = LISTV(K+1)
  185         <span class="kw">CONTINUE</span>
              LISTV(1) = LISTV(1) - 1
          <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*       Reduce higher particle locations by one (or three for c.m.).
</span>          <span class="kw">IF</span> (LISTV(L).GT.I) <span class="kw">THEN</span>
              LISTV(L) = LISTV(L) - 1
              <span class="kw">IF</span> (I.GT.N + 1) LISTV(L) = LISTV(L) - 2
          <span class="kw">END</span> <span class="kw">IF</span>
  190 <span class="kw">CONTINUE</span>
<span class="comm">*
</span><span class="comm">*       Check special case of second KS component removal.
</span>      <span class="kw">IF</span> (KCASE.GT.1) GO TO 205
<span class="comm">*
</span><span class="comm">*       See whether the escaper is a single particle or c.m.
</span>      <span class="kw">IF</span> (I.LE.N + 1) GO TO 12
<span class="comm">*
</span><span class="comm">*       Prepare removal of regularized pair.
</span>      IPAIR = I - N - 1
<span class="comm">*
</span><span class="comm">*       Skip correction if ghost is also merged binary (NAMEI = 0 below).
</span>      <span class="kw">IF</span> (NAMEI.NE.0.AND.BODY(2*IPAIR-1).GT.0.0D0) <span class="kw">THEN</span>
          ZMB = BODY(2*IPAIR-1) + BODY(2*IPAIR)
          ZM2 = BODY(2*IPAIR)
          EB = H(IPAIR)*BODY(2*IPAIR-1)*BODY(2*IPAIR)/ZMB
          SEMI = -0.5*ZMB/H(IPAIR)
          ECC2 = (1.0 - R(IPAIR)/SEMI)**2 + TDOT2(IPAIR)**2/(SEMI*ZMB)
          ECC = SQRT(ECC2)
          PMIN  = SEMI*(1.0 - ECC)
          RATIO = MAX(RADIUS(2*IPAIR-1),RADIUS(2*IPAIR))/PMIN
          NAME1 = NAME(2*IPAIR-1)
          KSTAR1 = KSTAR(2*IPAIR-1)
          PB = DAYS*SEMI*SQRT(SEMI/ZMB)
      <span class="kw">ELSE</span>
<span class="comm">*       Obtain two-body elements of ghost binary and update energies.
</span>          EB = 0.0D0
          RATIO = 0.0
          BODYCM = CM(3,IM) + CM(4,IM)
          SEMI = -0.5*BODYCM/H(JPAIR)
          ZMU = CM(3,IM)*CM(4,IM)/BODYCM
          PB = DAYS*SEMI*SQRT(SEMI/BODYCM)
          ECC2 = (1.0-R(JPAIR)/SEMI)**2 + TDOT2(JPAIR)**2/(BODYCM*SEMI)
          ECC = SQRT(ECC2)
          EB1 = ZMU*H(JPAIR)
          BE(3) = BE(3) - EB1
          EMERGE = EMERGE - EB1
          DEB = DEB + EB1
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Update total energy (ECOLL with EB < -1 & #27 > 0 affects BINOUT).
</span>      BE(3) = BE(3) - EB
<span class="comm">*
</span><span class="comm">*       Check optional diagnostics for hierarchical systems.
</span>      <span class="kw">IF</span> (NAMEI.LE.0.AND.(KZ(11).EQ.1.OR.KZ(11).EQ.3)) <span class="kw">THEN</span>
          IPHASE = 7
          <span class="kw">CALL</span> <a href="subroutine__HIARCH.html">HIARCH</a>(IPAIR)
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Specify binary type (0: standard; -1: merged binary).
</span>      M = 0
      <span class="kw">IF</span> (NAMEI.LE.0) M = -1
<span class="comm">*
</span><span class="comm">*       Distinguish between actual and ghost binary (mergers come later).
</span>      <span class="kw">IF</span> (BODY(2*IPAIR-1).GT.0.0D0) <span class="kw">THEN</span>
          NAME2 = NAME(2*IPAIR)
<span class="comm">*
</span><span class="comm">*       Include rare case of higher-order system (4, 5 or 6 members).
</span>          <span class="kw">IF</span> (NAMEI.LT.-2*NZERO) <span class="kw">THEN</span>
              JM = 1
              <span class="kw">DO</span> 195 K = 1,NMERGE
                  <span class="kw">IF</span> (NAMEM(K).EQ.NAMEI) JM = K
  195         <span class="kw">CONTINUE</span>
              I3HJ = N
              <span class="kw">DO</span> 196 J = IFIRST,NTOT
                  <span class="kw">IF</span> (NAME(J).EQ.NAMEG(JM)) I3HJ = J
  196         <span class="kw">CONTINUE</span>
<span class="comm">*       Identify quartet, quintuplet or sextuplet.
</span>              <span class="kw">IF</span> (NAME2.LE.NZERO.AND.NAME(I3HJ).LE.NZERO) <span class="kw">THEN</span>
                  WHICH1 = <span class="str">'  QUARTET  '</span>
<span class="comm">*       Include both types of quintuplet: [[B,S],B] and [[B,B],S].
</span>              <span class="kw">ELSE</span> <span class="kw">IF</span> (NAME2.LE.NZERO.OR.NAME(I3HJ).LE.NZERO) <span class="kw">THEN</span>
                  WHICH1 = <span class="str">' QUINTUPLET'</span>
              <span class="kw">ELSE</span>
                  WHICH1 = <span class="str">' SEXTUPLET '</span>
              <span class="kw">END</span> <span class="kw">IF</span>
              ZM1 = CM(1,JM)*ZMBAR
              ZM2 = CM(2,JM)*ZMBAR
              EB3 = CM(1,JM)*CM(2,JM)*HM(JM)/(CM(1,JM) + CM(2,JM))
              SEMI3 = -0.5*(CM(1,JM) + CM(2,JM))/HM(JM)
              PB3 = DAYS*SEMI3*SQRT(SEMI3/(CM(1,JM) + CM(2,JM)))
              <span class="kw">if</span>(rank.eq.0)
        WRITE (6,199)  WHICH1, NAME(2*IPAIR-1), NAME(2*IPAIR),
                       NAME(I3HJ), ZM1, ZM2, EB3, SEMI3, PB3
  199         <span class="kw">FORMAT</span> (/,A11,<span class="str">' ESCAPE    NM ='</span>,3I6,<span class="str">'  M ='</span>,2F5.1,
                    <span class="str">'  EB3 ='</span>,F8.4,<span class="str">'  A3 ='</span>,1P,E8.1,<span class="str">'  P3 ='</span>,E8.1)
          <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>          <span class="kw">if</span>(rank.eq.0)<span class="kw">then</span>
          VI = SQRT(0.5*VI2*ZMASS/ZKIN)
          WRITE (6,200)  IPAIR, NAME(2*IPAIR-1), NAME2,
                   KSTAR(2*IPAIR-1), KSTAR(2*IPAIR), KSTARI,
                   LIST(2,2*IPAIR), BODY(2*IPAIR-1)*ZMBAR,
                   BODY(2*IPAIR)*ZMBAR, EB, RATIO, VI, ECC, EI, PB
  200     <span class="kw">FORMAT</span> (/,<span class="str">' BINARY ESCAPE    KS ='</span>,I5,<span class="str">'  NM ='</span>,2I6,
                <span class="str">'  K* ='</span>,4I3,<span class="str">'  M ='</span>,2F5.1,<span class="str">'  EB ='</span>,F8.4,
                <span class="str">'  R*/PM ='</span>,F5.2,<span class="str">'  V/<V> ='</span>,F5.2,<span class="str">'  E ='</span>,F5.2,
                <span class="str">'  EI ='</span>,F8.5,<span class="str">'  P ='</span>,1P,E8.1)
          <span class="kw">end</span> <span class="kw">if</span>
      <span class="kw">ELSE</span>
          <span class="kw">if</span>(rank.eq.0)
    WRITE (6,202)  IPAIR, NAME(2*IPAIR-1), NAME(2*IPAIR),
                   LIST(2,2*IPAIR), KSTAR(JM), CM(3,IM)*ZMBAR,
                   CM(4,IM)*ZMBAR, EB1, ECC, SEMI, PB
  202     <span class="kw">FORMAT</span> (/,<span class="str">' QUAD ESCAPE    KS ='</span>,I5,<span class="str">'  NM ='</span>,2I6,
                <span class="str">'  K* ='</span>,2I3,<span class="str">'  M ='</span>,2F5.1,<span class="str">'  EB ='</span>,F8.4,
                <span class="str">'  E ='</span>,F7.3,<span class="str">'  A ='</span>,1P,E8.1,<span class="str">'  P ='</span>,E8.1)
          EB = EB + EB1
          EI = 0.0
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Accumulate escaping binary energies and increase the counter.
</span>      <span class="kw">IF</span> (LIST(2,2*IPAIR).EQ.-1) <span class="kw">THEN</span>
          E(5) = E(5) + EB
          E(6) = E(6) + EI
          NPOP(5) = NPOP(5) + 1
      <span class="kw">ELSE</span>
          E(7) = E(7) + EB
          E(8) = E(8) + EI
          NPOP(6) = NPOP(6) + 1
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>      <span class="kw">IF</span> (M.EQ.0) <span class="kw">THEN</span>
          NBESC = NBESC + 1
      <span class="kw">ELSE</span>
          NMESC = NMESC + 1
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Reduce particle number, pair index & single particle index. 
</span>      N = N - 1
      NPAIRS = NPAIRS - 1
      IFIRST = 2*NPAIRS + 1
<span class="comm">*
</span><span class="comm">*       Move up all tables of regularized pairs below IPAIR.
</span>      <span class="kw">IF</span> (IPAIR.LE.NPAIRS) <span class="kw">THEN</span>
          <span class="kw">CALL</span> <a href="subroutine__REMOVE.html">REMOVE</a>(IPAIR,2)
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Increase index for removing KS components.
</span>  205 KCASE = KCASE + 1
      <span class="kw">IF</span> (KCASE.LE.3) <span class="kw">THEN</span>
<span class="comm">*       Remove COMMON arrays of the second component before the first.
</span>          I = 2*IPAIR + 2 - KCASE
          NTOT = NTOT - 1
<span class="comm">*       Reduce NTOT by 3 and N by 2 when KS pair escapes.
</span>          <span class="kw">CALL</span> <a href="subroutine__REMOVE.html">REMOVE</a>(I,3)
          GO TO 60
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Check selection of possible ghost in higher-order system.
</span>      <span class="kw">IF</span> (I3HI.GT.0) <span class="kw">THEN</span>
          I = 0
          <span class="kw">DO</span> 208 J = IFIRST,NTOT
              <span class="kw">IF</span> (NAME(J).EQ.NAMEG(JM)) <span class="kw">THEN</span>
                  I = J
              <span class="kw">END</span> <span class="kw">IF</span>
  208     <span class="kw">CONTINUE</span>
          <span class="kw">IF</span> (I.GT.0) <span class="kw">THEN</span>
              I3HI = 0
              GO TO 50
          <span class="kw">END</span> <span class="kw">IF</span>
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Include the case of escaping merger.
</span>      <span class="kw">IF</span> (NAMEI.GE.0) GO TO 250
<span class="comm">*
</span><span class="comm">*       Locate current position in the merger table (standard case).
</span>      IM = 0
      <span class="kw">DO</span> 210 K = 1,NMERGE
          <span class="kw">IF</span> (NAMEM(K).EQ.NAMEI) IM = K
  210 <span class="kw">CONTINUE</span>
<span class="comm">*       Skip on failed detection just in case.
</span>      <span class="kw">IF</span> (IM.EQ.0) GO TO 250
<span class="comm">*
</span><span class="comm">*       Include case of higher-order system (outer single or binary).
</span>      DEB = 0.0
      <span class="kw">IF</span> (NAMEI.LT.0) <span class="kw">THEN</span>
<span class="comm">*       Determine the ghost index.
</span>          I3HI = 0
          <span class="kw">DO</span> 215 J = IFIRST,NTOT
              <span class="kw">IF</span> (NAME(J).EQ.NAMEG(IM)) I3HI = J
  215     <span class="kw">CONTINUE</span>
<span class="comm">*       Specify nominal escape distance for ghost removal.
</span>          X(1,I3HI) = 1.0D+04
<span class="comm">*       Define possible KS pair index for quadruple system correction.
</span>          JPAIR = I3HI - N
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Consider current ghost unless deeper hierarchy is present.
</span>      JM = IM
      <span class="kw">IF</span> (I3HI.GT.0) <span class="kw">THEN</span>
<span class="comm">*       Search for c.m. name one level below current (NAMEI < 0).
</span>          <span class="kw">IF</span> (NAMEI.LT.-2*NZERO) <span class="kw">THEN</span>
              <span class="kw">DO</span> 220 K = 1,NMERGE
                  <span class="kw">IF</span> (NAMEM(K).EQ.NAMEI + 2*NZERO) JM = K
  220         <span class="kw">CONTINUE</span>
<span class="comm">*       Use previous merger index to look for binary ghost at earlier level.
</span>              I30 = I3HI
              <span class="kw">DO</span> 225 J = IFIRST,NTOT
                  <span class="kw">IF</span> (NAME(J).EQ.NAMEG(JM)) I3HI = J
  225         <span class="kw">CONTINUE</span>
              <span class="kw">IF</span> (I3HI.GT.N) <span class="kw">THEN</span>
                  JPAIR = I3HI - N
              <span class="kw">ELSE</span>
<span class="comm">*       Adopt original solution on failure to identify binary.
</span>                  I3HI = I30
              <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*       Set nominal escape distance of any new ghost (I3HI <= N possible).
</span>              X(1,I3HI) = 1.0D+04
          <span class="kw">END</span> <span class="kw">IF</span>
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Copy merger energy to respective energy bins (primordial or new).
</span>      ZMU = CM(1,JM)*CM(2,JM)/(CM(1,JM) + CM(2,JM))
      <span class="kw">IF</span> (MIN(NAME1,NAMEG(JM)).LE.2*NBIN0) <span class="kw">THEN</span>
          E(5) = E(5) + ZMU*HM(JM) + DEB
      <span class="kw">ELSE</span>
          E(7) = E(7) + ZMU*HM(JM) + DEB
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Reduce membership if IM is last (otherwise done in RESET).
</span>      <span class="kw">IF</span> (IM.EQ.NMERGE) <span class="kw">THEN</span>
          NMERGE = NMERGE - 1
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Identify merged ghost particle (single body or binary c.m.).
</span>      JCOMP = -1
      <span class="kw">DO</span> 230 J = IFIRST,NTOT
          <span class="kw">IF</span> (BODY(J).EQ.0.0D0.AND.NAME(J).EQ.NAMEG(IM)) JCOMP = J
  230 <span class="kw">CONTINUE</span>
<span class="comm">*       Include search over lower level on failed identification.
</span>      <span class="kw">IF</span> (JCOMP.EQ.-1.AND.I3HI.GT.0) <span class="kw">THEN</span>
          <span class="kw">DO</span> 232 J = IFIRST,NTOT
              <span class="kw">IF</span> (BODY(J).EQ.0.0D0.AND.NAME(J).EQ.NAMEG(JM)) JCOMP = J
  232     <span class="kw">CONTINUE</span>
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span><span class="comm">*       Skip if correct ghost not identified (note I3HI # JCOMP if JM # IM).
</span>      <span class="kw">IF</span> (JCOMP.GT.0) <span class="kw">THEN</span>
          I = I3HI
<span class="comm">*       Form two-body elements and period of inner binary.
</span>          NAMEI = 0
          NPOP(7) = NPOP(7) + 1
          BODYCM = CM(1,JM) + CM(2,JM)
          SEMI0 = -0.5*BODYCM/HM(JM)
          ZMU = CM(1,JM)*CM(2,JM)/BODYCM
          EB = ZMU*HM(JM)
          PB = DAYS*SEMI0*SQRT(SEMI0/BODYCM)
          BE(3) = BE(3) - EB
          EMERGE = EMERGE - EB
<span class="comm">*       Include extra correction for mergers between binary pairs.
</span>          <span class="kw">IF</span> (JM.LT.IM) <span class="kw">THEN</span>
              ZMU2 = CM(1,IM)*CM(2,IM)/(CM(1,IM) + CM(2,IM))
              EB2 = ZMU2*HM(IM)
              BE(3) = BE(3) - EB2
              EMERGE = EMERGE - EB2
<span class="comm">*       Copy smaller index for QUAD binary output.
</span>              IM = JM
          <span class="kw">END</span> <span class="kw">IF</span>
          RJ = 0.0
          TD2 = 0.0
          <span class="kw">DO</span> 235 K = 1,4
              RJ = RJ + UM(K,JM)**2
              TD2 = TD2 + 2.0*UM(K,JM)*UMDOT(K,JM)
  235     <span class="kw">CONTINUE</span>
          ECC2 = (1.0 - RJ/SEMI0)**2 + TD2**2/(BODYCM*SEMI0)
          ECC0 = SQRT(ECC2)
          Q = ZM2/BODYCM
          XFAC = (1.0 + Q)*(1.0 + ECC)/SQRT(1.0 - ECC)
          PCRIT = 2.8*XFAC**0.4*SEMI0
<span class="comm">*
</span>          <span class="kw">if</span>(rank.eq.0)
    WRITE (6,240)  NAME1, NAMEG(JM), KSTAR1, KSTAR(JCOMP),
                   KSTARM(JM), CM(1,JM)*ZMBAR, CM(2,JM)*ZMBAR,
                   EB, ECC0, PMIN/PCRIT, SEMI0, PB
  240     <span class="kw">FORMAT</span> (/,<span class="str">' HIARCH ESCAPE    NM ='</span>,2I6,<span class="str">'  K* ='</span>,3I3,
              <span class="str">'  M ='</span>,2F5.1,<span class="str">'  EB ='</span>,F8.4,<span class="str">'  E ='</span>,F7.3,
              <span class="str">'  PM/PC ='</span>,1P,E8.1,<span class="str">'  A ='</span>,E8.1,<span class="str">'  P ='</span>,E8.1)
<span class="comm">*
</span><span class="comm">*       Remove the ghost particle (NAME = 0 & EB = 0 for second binary).
</span>          GO TO 50
      <span class="kw">END</span> <span class="kw">IF</span>
<span class="comm">*
</span>  250 I = IPAIR + N
      GO TO 12
<span class="comm">*
</span>      <span class="kw">END</span>
</pre>
            
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
